import{r as L}from"./request-ChjQmMKM.js";import{f as Y}from"./tools-DlxY66FA.js";import{_ as A,r,$ as N,i as B,o as v,w as a,e as s,a as l,d as g,q as y,t as m,E as R,B as E,m as j,a4 as J,v as P,c as F,y as K,z as O,Y as Q,F as H,f as X}from"./index-BwAutTYV.js";import"./currency-BaKDgkX2.js";const Z=e=>L({url:"/app/ticket/list",method:"post",data:e}),x=e=>L({url:"/app/ticket/submit",method:"post",data:e}),ee=e=>L({url:"/app/ticket/reply",method:"post",data:e}),te=e=>L({url:"/app/ticket/records?ticketId="+e,method:"get"}),le={class:"dialog-footer"},ae={__name:"TicketForm",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","submit"],setup(e,{emit:u}){const _=e,V=u,$=r(null),h=r(!1),d=r({title:"",content:""}),p=r(!1);N(()=>_.modelValue,o=>{p.value=o,d.value={}}),N(()=>p.value,o=>{V("update:modelValue",o)});const S={title:[{required:!0,message:"请输入标题",trigger:"blur"}]},c=async()=>{$.value&&await $.value.validate(async o=>{if(o){h.value=!0;try{console.log(d.value);const n=d.value;await x(n),V("submit",d.value),R.success("success"),p.value=!1}catch(n){R.error(n)}finally{h.value=!1}}})};return(o,n)=>{const w=s("el-input"),T=s("el-form-item"),b=s("el-form"),C=s("el-button"),D=s("el-dialog");return v(),B(D,{modelValue:p.value,"onUpdate:modelValue":n[3]||(n[3]=t=>p.value=t),title:o.$t("ticket.ticketForm.title"),width:"800px","close-on-click-modal":!1},{footer:a(()=>[g("span",le,[l(C,{onClick:n[2]||(n[2]=t=>p.value=!1)},{default:a(()=>[y(m(o.$t("submit.global_cancel")),1)]),_:1}),l(C,{type:"primary",onClick:c,loading:h.value},{default:a(()=>[y(m(o.$t("submit.gloabl_confirm")),1)]),_:1},8,["loading"])])]),default:a(()=>[l(b,{ref_key:"formRef",ref:$,model:d.value,rules:S,"label-width":"150px",class:"address-form"},{default:a(()=>[l(T,{label:o.$t("ticket.ticketForm.titleLabel"),prop:"title"},{default:a(()=>[l(w,{modelValue:d.value.title,"onUpdate:modelValue":n[0]||(n[0]=t=>d.value.title=t),placeholder:o.$t("ticket.ticketForm.titlePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(T,{label:o.$t("ticket.ticketForm.contentLabel")},{default:a(()=>[l(w,{modelValue:d.value.content,"onUpdate:modelValue":n[1]||(n[1]=t=>d.value.content=t),type:"textarea",rows:5,placeholder:o.$t("ticket.ticketForm.contentPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},oe=A(ae,[["__scopeId","data-v-ce5b26ac"]]),ne={class:"order-list-content"},se={key:0},ie={key:0,class:"message-other"},re={key:0,class:"message-me"},ue={key:0},ce={class:"dialog-footer"},de={__name:"TicketDetailForm",props:{modelValue:{type:Boolean,default:!1},ticketId:{type:Number,default:""},ticketStatus:{type:Number,default:""}},emits:["update:modelValue","submit"],setup(e,{emit:u}){const _=e,V=E({data:[]}),$=u,h=r(null),d=r(null),p=r(0),S=r(!1),c=r({content:""}),o=r(),n=r(!1);N(()=>_.modelValue,t=>{V.data=[],n.value=t,c.value={},_.ticketId&&(d.value=_.ticketId),p.value=_.ticketStatus,C()}),N(()=>n.value,t=>{$("update:modelValue",t)});const w={content:[{required:!0,message:"请输入内容",trigger:"blur"}]},T=async()=>{h.value&&await h.value.validate(async t=>{if(t)try{if(!c.value||!c.value.content)return;const i=c.value;i.ticketId=d.value,await ee(i),c.value={},C()}catch(i){R.error(i)}})},b=async()=>{V.data=[],n.value=!1,$("submit",c.value)},C=async()=>{try{const t=await te(d.value);V.data=t.data||[],setTimeout(()=>{D()},600)}catch(t){const i=t.message||"Get ticket detail fail";R.error(i)}finally{}},D=()=>{const t=o.value,i=t.$el.querySelector(".el-table__body");i&&(console.log(2),t.setScrollTop(i.scrollHeight))};return j(()=>{}),(t,i)=>{const U=s("el-avatar"),I=s("el-table-column"),q=s("el-table"),f=s("el-input"),z=s("el-form-item"),M=s("el-form"),G=s("el-button"),W=s("el-dialog");return v(),B(W,{modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=k=>n.value=k),title:t.$t("ticket.ticketDetailForm.title"),width:"800px","close-on-click-modal":!1},J({default:a(()=>[g("div",ne,[l(q,{data:V.data,style:{width:"100%"},stripe:"","max-height":"500px","show-header":!1,ref_key:"tableRef",ref:o},{default:a(()=>[l(I,{width:"60"},{default:a(({row:k})=>[k.source===1?(v(),F("div",se,[l(U,{style:{"background-color":"#f389d6"}},{default:a(()=>i[2]||(i[2]=[y(" CS ")])),_:1})])):P("",!0)]),_:1}),l(I,{width:"320"},{default:a(({row:k})=>[k.source===1?(v(),F("div",ie,[g("p",null,m(k.gmtCreate),1),g("p",null,m(k.content),1)])):P("",!0)]),_:1}),l(I,{width:"320"},{default:a(({row:k})=>[k.source===0?(v(),F("div",re,[g("p",null,m(k.gmtCreate),1),g("p",null,m(k.content),1)])):P("",!0)]),_:1}),l(I,{width:"60"},{default:a(({row:k})=>[k.source===0?(v(),F("div",ue,[l(U,{style:{"background-color":"rgb(154 164 252)"}},{default:a(()=>i[3]||(i[3]=[y(" ME ")])),_:1})])):P("",!0)]),_:1})]),_:1},8,["data"])]),p.value!=2?(v(),B(M,{key:0,ref_key:"formRef",ref:h,model:c.value,rules:w,"label-width":"0px",class:"address-form"},{default:a(()=>[l(z,{label:t.$t("ticket.ticketDetailForm.contentLabel")},{default:a(()=>[l(f,{modelValue:c.value.content,"onUpdate:modelValue":i[0]||(i[0]=k=>c.value.content=k),type:"textarea",rows:3,placeholder:t.$t("ticket.ticketDetailForm.contentPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])):P("",!0)]),_:2},[p.value!==2?{name:"footer",fn:a(()=>[g("span",ce,[l(G,{onClick:b},{default:a(()=>[y(m(t.$t("submit.global_cancel")),1)]),_:1}),l(G,{type:"primary",onClick:T,loading:S.value},{default:a(()=>[y(m(t.$t("submit.gloabl_confirm")),1)]),_:1},8,["loading"])])]),key:"0"}:void 0]),1032,["modelValue","title"])}}},me=A(de,[["__scopeId","data-v-756c6f3c"]]),pe=K({name:"TicketList",components:{TicketForm:oe,TicketDetailForm:me},setup(){const e=E({currentPage:1,pageSize:10}),u=E({keyword:"",status:null}),{proxy:_}=O(),V=Q(()=>[{status:0,label:_.$t("ticket.statusItem.submitted")},{status:1,label:_.$t("ticket.statusItem.processing")},{status:2,label:_.$t("ticket.statusItem.completed")}]),$=r(!1),h=r(!1),d=r(null),p=r(null),S=r([]),c=r(0),o=r(!1),n=r(null),w=r({}),T=(f,z,M)=>Y(f,z,M),b=async()=>{try{o.value=!0,n.value=null;let f={pageNo:e.currentPage,pageSize:e.pageSize,...u};const z=await Z(f);S.value=z.data,c.value=z.total}catch(f){n.value=f.message||"获取工单失败",R.error(n.value)}finally{o.value=!1}},C=()=>{e.currentPage=1,b()},D=f=>{e.pageSize=f,b()},t=f=>{e.currentPage=f,b()},i=()=>{b()},U=()=>{b()},I=()=>{w.value={},$.value=!0},q=f=>{h.value=!0,d.value=f.id,p.value=f.status};return b(),{statusItems:V,searchForm:u,ticketList:S,total:c,pagination:e,formData:w,handleSizeChange:D,handleCurrentChange:t,handleSearch:C,handleAddTicket:I,ticketDialogVisible:$,ticketDetailDialogVisible:h,handleTicketSubmit:i,handleTicketDetailSubmit:U,handleView:q,formatTitleC:T,detailTicketId:d,detailTicketStatus:p}}}),ke={class:"order-list"},fe={class:"search-toolbar"},ge={class:"search-toolbar"},be={class:"order-list-content"},ve={key:0},_e={key:1},he={class:"pagination"},ye={class:"total"};function Ve(e,u,_,V,$,h){const d=s("el-input"),p=s("el-option"),S=s("el-select"),c=s("el-button"),o=s("el-table-column"),n=s("el-tag"),w=s("el-badge"),T=s("el-table"),b=s("el-pagination"),C=s("TicketForm"),D=s("TicketDetailForm");return v(),F(H,null,[g("div",ke,[g("div",fe,[l(d,{modelValue:e.searchForm.keyword,"onUpdate:modelValue":u[0]||(u[0]=t=>e.searchForm.keyword=t),placeholder:e.$t("ticket.keywordPlaceholder"),class:"search-input"},null,8,["modelValue","placeholder"]),l(S,{placeholder:e.$t("ticket.statusPlaceholder"),modelValue:e.searchForm.status,"onUpdate:modelValue":u[1]||(u[1]=t=>e.searchForm.status=t),style:{width:"30%"}},{default:a(()=>[(v(!0),F(H,null,X(e.statusItems,t=>(v(),B(p,{key:t.status,label:t.label,value:t.status},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]),l(c,{onClick:e.handleSearch},{default:a(()=>[y(m(e.$t("header.searchButton")),1)]),_:1},8,["onClick"])]),g("div",ge,[l(c,{type:"primary",link:"",class:"new-address",onClick:e.handleAddTicket},{default:a(()=>[y(m(e.$t("ticket.add")),1)]),_:1},8,["onClick"])]),g("div",be,[l(T,{data:e.ticketList,style:{width:"100%"},stripe:"",onRowDblclick:e.handleView,"highlight-current-row":!0},{default:a(()=>[l(o,{prop:"title",label:e.$t("ticket.title"),width:"500"},null,8,["label"]),l(o,{prop:"gmtCreate",label:e.$t("commont.createTime"),width:"250"},null,8,["label"]),l(o,{label:e.$t("ticket.status"),width:"150"},{default:a(({row:t})=>[l(n,null,{default:a(()=>[y(m(e.formatTitleC(t,"statusDesc","trans")),1)]),_:2},1024)]),_:1},8,["label"]),l(o,{label:e.$t("commont.operation"),width:"150"},{default:a(t=>[t.row.unReadMsgNum?(v(),F("div",ve,[l(w,{value:t.row.unReadMsgNum,class:"item"},{default:a(()=>[l(c,{type:"primary",link:"",onClick:i=>e.handleView(t.row)},{default:a(()=>[y(m(e.$t("ticket.view")),1)]),_:2},1032,["onClick"])]),_:2},1032,["value"])])):(v(),F("div",_e,[l(c,{type:"primary",link:"",onClick:i=>e.handleView(t.row)},{default:a(()=>[y(m(e.$t("ticket.view")),1)]),_:2},1032,["onClick"])]))]),_:1},8,["label"])]),_:1},8,["data","onRowDblclick"])]),g("div",he,[g("div",ye,m(e.$t("commont.total"))+" "+m(e.total)+" "+m(e.$t("commont.page")),1),l(b,{"current-page":e.pagination.currentPage,"onUpdate:currentPage":u[2]||(u[2]=t=>e.pagination.currentPage=t),"page-size":e.pagination.pageSize,"onUpdate:pageSize":u[3]||(u[3]=t=>e.pagination.pageSize=t),"page-sizes":[10,20,50],total:e.total,layout:"prev, pager, next, sizes",onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),l(C,{modelValue:e.ticketDialogVisible,"onUpdate:modelValue":u[4]||(u[4]=t=>e.ticketDialogVisible=t),onSubmit:e.handleTicketSubmit},null,8,["modelValue","onSubmit"]),l(D,{modelValue:e.ticketDetailDialogVisible,"onUpdate:modelValue":u[5]||(u[5]=t=>e.ticketDetailDialogVisible=t),ticketId:e.detailTicketId,ticketStatus:e.detailTicketStatus,onSubmit:e.handleTicketDetailSubmit},null,8,["modelValue","ticketId","ticketStatus","onSubmit"])],64)}const Te=A(pe,[["render",Ve],["__scopeId","data-v-2e1f56d5"]]);export{Te as default};
