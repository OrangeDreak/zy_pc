import{_ as W,r as p,aa as g,v as X,n as k,o as C,w as s,i as u,e as o,ab as Y,g as h,q as I,f as A,M as F,d as T,y as Z,k as x,N as ee,F as ae,j as le,E as b}from"./index-CfP2wwIO.js";import{r as c}from"./request-CL1ELcKn.js";import{S as oe}from"./index-BMHUUl_b.js";const V={country(t){return c({url:"/app/area/listByLevel",method:"get",params:t})},province(t){return c({url:"/app/area/listByParentId",method:"get",params:t})},addUserAddress(t){return c({url:"/app/userAddress/add",method:"post",data:t})},updateUserAddress(t){return c({url:"/app/userAddress/update",method:"post",data:t})},getCustomCode(t){return c({url:"/app/user/randomUserNO",method:"get",params:t})},submitTpOrder(t){return c({url:"/app/tp/order/submitTpOrder",method:"post",data:t})},subUserList(t){return c({url:"/app/user/subUserList",method:"post",data:t})}},re={class:"value-con country-con"},se={key:0,class:"close-icon"},te={class:"dialog-footer"},de={__name:"AddressForm",props:{modelValue:{type:Boolean,default:!1},subCode:{type:String,default:""},formData:{type:Object,default:()=>{}}},emits:["update:modelValue","submit"],setup(t,{emit:S}){const d=t,N=S,_=p(null),n=p(null),$=p(!1),q=p(""),l=p({name:"",address:"",mobile:"",countryId:"",provinceId:"",cityName:"",postcode:"",subCode:""}),v=p(!1);g(()=>d.modelValue,a=>{v.value=a,l.value={},n.value="",d.subCode&&(l.value.subCode=d.subCode),d.formData.userAddressInfo&&(l.value={...d.formData.userAddressInfo},l.value.name=d.formData.userAddressInfo.firstName,l.value.subCode=d.subCode,n.value=d.formData.userAddressInfo.countryName)}),g(()=>v.value,a=>{N("update:modelValue",a)}),p([]);const w=p([]),B={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],address:[{required:!0,message:"请输入地址",trigger:"blur"}],mobile:[{required:!0,message:"请输入电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],countryId:[{required:!0,message:"请选择国家",trigger:"blur"}],provinceId:[{required:!0,message:"请选择省份",trigger:"blur"}],postcode:[{required:!0,message:"请输入邮编",trigger:"blur"},{pattern:/^\d{6}$/,message:"请输入正确的邮政编码",trigger:"blur"}]},D=async a=>{try{const e=await V.province({parentId:a});w.value=e.data.map(f=>({value:f.id,label:f.areaName}))}catch(e){console.error("获取省份列表失败:",e),b.error("获取省份列表失败")}},O=async()=>{try{const a=await V.getCustomCode();l.value.subCode=a.data}catch{b.error("获取自定义编码失败")}};g(q,async a=>{if(a)try{setTimeout(()=>{const e={name:"张三",address:"北京市朝阳区xxx街道xxx号",mobile:"13800138000",country:"CN",province:"BJ",cityName:"北京",postcode:"100000"};l.value=e,b.success("地址解析成功")},500)}catch(e){console.error("地址解析失败:",e),b.error("地址解析失败")}}),g(()=>l.value.countryId,async a=>{a&&await D(a)});const y=p(),E=()=>{y.value.openPopver()},L=()=>{n.value===""&&(l.value.countryId=null),y.value.countrySearch(n.value)},M=a=>{l.value.countryId!==a.id&&(l.value.countryId=a.id,n.value=`${a.areaEnName} ${a.areaName}`,l.value.provinceId=null)},P=()=>{n.value="",l.value.countryId=null,y.value.countrySearch(n.value)},R=async()=>{_.value&&await _.value.validate(async a=>{if(a){$.value=!0;try{console.log(l.value);const e=l.value;e.firstName=e.name,e.lastName=e.name,e.subCode=e.subCode!==""?e.subCode:d.subCode,d.formData.addressId?(e.addressId=d.formData.addressId,await V.updateUserAddress(e)):await V.addUserAddress(e),N("submit",l.value),b.success("保存成功"),v.value=!1}catch(e){console.error("保存失败:",e),b.error("保存失败")}finally{$.value=!1}}})};return X(()=>{}),(a,e)=>{const f=u("el-button"),i=u("el-input"),m=u("el-form-item"),U=u("el-col"),j=u("a-input"),H=u("svg-icon"),J=u("el-option"),z=u("el-select"),G=u("el-row"),K=u("el-form"),Q=u("el-dialog");return C(),k(Q,{modelValue:v.value,"onUpdate:modelValue":e[11]||(e[11]=r=>v.value=r),title:a.$t("addressForm.title"),width:"800px","close-on-click-modal":!1},{footer:s(()=>[A("span",te,[o(f,{onClick:e[10]||(e[10]=r=>v.value=!1)},{default:s(()=>[h(I(a.$t("submit.global_cancel")),1)]),_:1}),o(f,{type:"primary",onClick:R,loading:$.value},{default:s(()=>[h(I(a.$t("submit.gloabl_confirm")),1)]),_:1},8,["loading"])])]),default:s(()=>[o(K,{ref_key:"formRef",ref:_,model:l.value,rules:B,"label-width":"80px",class:"address-form"},{default:s(()=>[o(G,{gutter:20},{default:s(()=>[o(U,{span:12},{default:s(()=>[o(m,{label:a.$t("addressForm.customerCode"),prop:"subCode"},{default:s(()=>[o(i,{disabled:!!d.subCode,modelValue:l.value.subCode,"onUpdate:modelValue":e[0]||(e[0]=r=>l.value.subCode=r),placeholder:a.$t("addressForm.customerCodeTip")},Y({_:2},[d.subCode?void 0:{name:"append",fn:s(()=>[o(f,{class:"primary-btn",type:"primary",onClick:O},{default:s(()=>[h(I(a.$t("addressForm.customCodeRandom")),1)]),_:1})]),key:"0"}]),1032,["disabled","modelValue","placeholder"])]),_:1},8,["label"]),o(m,{label:a.$t("addressForm.name"),prop:"name"},{default:s(()=>[o(i,{modelValue:l.value.name,"onUpdate:modelValue":e[1]||(e[1]=r=>l.value.name=r),placeholder:a.$t("addressForm.nameTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{label:a.$t("addressForm.address"),prop:"address"},{default:s(()=>[o(i,{modelValue:l.value.address,"onUpdate:modelValue":e[2]||(e[2]=r=>l.value.address=r),placeholder:a.$t("addressForm.addressTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{label:a.$t("addressForm.email"),prop:"email"},{default:s(()=>[o(i,{modelValue:l.value.email,"onUpdate:modelValue":e[3]||(e[3]=r=>l.value.email=r),placeholder:a.$t("addressForm.emailTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{label:a.$t("addressForm.phoneNumber"),prop:"mobile"},{default:s(()=>[o(i,{modelValue:l.value.mobile,"onUpdate:modelValue":e[4]||(e[4]=r=>l.value.mobile=r),placeholder:a.$t("addressForm.phoneNumberTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),o(U,{span:12},{default:s(()=>[o(m,{label:a.$t("addressForm.country"),prop:"countryId"},{default:s(()=>[o(oe,{ref_key:"refSelectCountry",ref:y,onCountryChange:M},{default:s(()=>[A("div",re,[o(j,{value:n.value,"onUpdate:value":e[5]||(e[5]=r=>n.value=r),bordered:!1,placeholder:a.$t("estimate.selectCountry"),style:{width:"100%",padding:"0 11px"},onClick:F(E,["stop"]),onChange:L},{suffix:s(()=>[n.value?(C(),T("span",se,[o(x(ee),{onClick:F(P,["stop"])})])):Z("",!0)]),_:1},8,["value","placeholder"]),o(H,{class:"arrow-icon",name:"arrow-down",onClick:e[6]||(e[6]=F(()=>{},["stop"]))})])]),_:1},512)]),_:1},8,["label"]),o(m,{label:a.$t("addressForm.province"),prop:"provinceId"},{default:s(()=>[o(z,{modelValue:l.value.provinceId,"onUpdate:modelValue":e[7]||(e[7]=r=>l.value.provinceId=r),placeholder:a.$t("addressForm.provinceTip"),filterable:""},{default:s(()=>[(C(!0),T(ae,null,le(w.value,r=>(C(),k(J,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{label:a.$t("addressForm.city"),prop:"cityName"},{default:s(()=>[o(i,{modelValue:l.value.cityName,"onUpdate:modelValue":e[8]||(e[8]=r=>l.value.cityName=r),placeholder:a.$t("addressForm.cityTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{label:a.$t("addressForm.postCode"),prop:"postcode"},{default:s(()=>[o(i,{modelValue:l.value.postcode,"onUpdate:modelValue":e[9]||(e[9]=r=>l.value.postcode=r),placeholder:a.$t("addressForm.postCodeTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},pe=W(de,[["__scopeId","data-v-24e497ad"]]);export{pe as A,V as t};
