import{a as L}from"./orderList-C9XuQunX.js";import{a7 as ee,G as te,C as j,r as N,a1 as ae,v as se,D as ne,E as _,u as le,a0 as ie,_ as re,d as c,o as l,f as n,y as d,F as O,j as A,e as r,i as g,w as i,q as a,K as M,g as f,n as k}from"./index-DpJ1gIYA.js";import{f as oe,b as ce}from"./tools-CBk_1Li6.js";import"./request-BnDCzrW2.js";import"./currency-vLgtOeoe.js";const de=ee({name:"OrderList",setup(){const e=le(),h=ne(),E=(s,u,$)=>oe(s,u,$),R=(s,u)=>ce(s,u),{proxy:y}=te(),Q=({row:s})=>s.isMark?"status-mark":"",S=j({currentPage:1,pageSize:10}),p=j({userNo:"",trackingNo:"",isMark:0}),m=N([]),z=N(0),T=N(!1),I=N(null),D=N({}),C=N(-1),v=N([]),U=ae(()=>[{status:-1,icon:"icon-all",label:y.$t("package.status.all"),count:"allOrder"},{status:0,icon:"icon-recorded",label:y.$t("package.status.recorded"),count:"enterCount"},{status:1,icon:"icon-qc",label:y.$t("package.status.qc"),count:"qcCount"},{status:10,icon:"icon-shipped",label:y.$t("package.status.waitPay"),count:"waitPayCount"},{status:11,icon:"icon-processing",label:y.$t("package.status.processing"),count:"waitSendCount"},{status:12,icon:"icon-delivered",label:y.$t("package.status.delivered"),count:"sendCount"},{status:13,icon:"icon-finished",label:y.$t("package.status.finished"),count:"signCount"}]);se(()=>{h.query.userNo&&(p.userNo=h.query.userNo),F()});const V=async s=>{v.value=s},q=async()=>{e.push("/estimate")},B=async()=>{if(v.value.length===0){_.error(y.$t("order.orderSelectTip"));return}if(v.value.length>0){const P=v.value[0].userNo;if(!v.value.every(x=>x.userNo===P)){_.error("所选订单的用户编号不一致");return}}let s=v.value[0].userNo,u=!0;if(v.value.forEach(P=>{P.userNo!==s&&(u=!1)}),!u){_.error(y.$t("order.orderNotSameUserTip"));return}const $=v.value.map(P=>P.id);console.log($),sessionStorage.setItem("SubOrderIds",$),e.push("/submit-transfer")},t=s=>{e.push("/package-detail?id="+s.id)},o=s=>{e.push({path:"/pay",query:{payType:3,userPayId:s.userPayId||void 0,source:"package-list"}})},b=s=>{e.push({path:"/pay",query:{payType:7,userPayId:s.debtUserPayId||void 0,source:"repayment"}})},G=async s=>{try{await ie.confirm("确认取消包裹订单吗？","提示",{type:"warning"}).then(async()=>{await L.packageOrderCancel({packageOrderId:s.id,cancelReason:"cancel"}).then(u=>{u.code===200&&F()})})}catch(u){console.error("删除失败:",u)}},F=async()=>{try{T.value=!0,I.value=null;let s={pageNo:S.currentPage,pageSize:S.pageSize,...p};s.isMark||delete s.isMark,m.value=[];let u="getOrderList";C.value<10?(s.status=C.value,C.value===-1&&delete s.status,u="getOrderList"):(s.status=C.value,u="myPackageOrderList");const $=await L[u](s);m.value=$.data,z.value=$.total}catch(s){I.value=s.message||"获取订单失败",_.error("获取订单列表失败")}finally{T.value=!1}},K=()=>{F()},H=()=>{p.isMark=p.isMark?0:1,F()},W=async()=>{try{const s=await L.getOrderCount();D.value=s.data}catch{}},J=s=>{S.pageSize=s,F()},X=s=>{S.currentPage=s,F()},Y=async s=>{const{data:u}=await L.updateAttentionMark({tpSubOrderId:s.id,isMark:s.isMark?0:1,orderType:C.value<10?0:1});_.success("特别关注状态更新成功"),F()},Z=async s=>{const{data:u}=await L.getSharingCode({userNo:s.userNo,orderId:s.id}),$=`${window.location.origin}/order-share-transfer?code=${u}`;navigator.clipboard.writeText($).then(()=>{console.log("内容已成功复制到剪切板")}).catch(P=>{console.error("无法复制内容到剪切板:",P)}),_.success("分享订单成功")},w=s=>{C.value=s,F()};return W(),{searchForm:p,orders:m,total:z,pagination:S,status:C,flowItems:U,selectedOrders:v,countList:D,handleSizeChange:J,handleCurrentChange:X,handleFlowItemClick:w,handleStarClick:Z,handleMarkClick:Y,handleSelectionChange:V,handleSendSubmit:B,handleEstimate:q,getCountList:W,handleSearch:K,handleSearchMark:H,tableRowClassName:Q,handlePackageClick:t,handlePayClick:o,handleDebtPayClick:b,handleCancelClick:G,formatTitleC:E,formatPriceC:R}}}),ue={class:"order-list"},pe={class:"order-flow"},ge=["onClick"],me={class:"search-toolbar"},ke={class:"order-list-content"},he={class:"user-info"},ve={key:0},ye={key:0},fe={class:"timeline"},Ce={class:"image-list"},be={key:1,class:"estimate-info"},$e={key:0},Se={key:0},Fe={class:"timeline"},Pe={class:"image-list"},Ne={key:0},_e={class:"tip"},ze={key:1},Te={class:"tip"},Ie={key:2},De={class:"tip"},Le={key:3},Oe={class:"tip"},Ae={key:4},Me={class:"tip"},Ue={key:0,class:"btn-box"},Ve={class:"pagination"},qe={class:"total"};function Be(e,h,E,R,y,Q){const S=g("el-input"),p=g("el-button"),m=g("el-table-column"),z=g("el-timeline-item"),T=g("el-timeline"),I=g("el-popover"),D=g("el-image"),C=g("QuestionFilled"),v=g("el-icon"),U=g("el-tooltip"),V=g("el-tag"),q=g("el-table"),B=g("el-pagination");return l(),c("div",ue,[n("div",pe,[(l(!0),c(O,null,A(e.flowItems,t=>(l(),c("div",{key:t.status,class:M(["flow-item",{active:t.status===e.status}]),onClick:o=>e.handleFlowItemClick(t.status)},[n("i",{class:M(t.icon)},null,2),n("span",null,a(t.label)+"("+a(e.countList[t.count])+")",1)],10,ge))),128))]),n("div",me,[r(S,{modelValue:e.searchForm.trackingNo,"onUpdate:modelValue":h[0]||(h[0]=t=>e.searchForm.trackingNo=t),placeholder:e.$t("order.toolbar.trackingSearch"),class:"search-input"},null,8,["modelValue","placeholder"]),r(S,{modelValue:e.searchForm.userNo,"onUpdate:modelValue":h[1]||(h[1]=t=>e.searchForm.userNo=t),placeholder:e.$t("order.toolbar.customerSearch"),class:"search-input"},null,8,["modelValue","placeholder"]),r(p,{onClick:e.handleSearch},{default:i(()=>[f(a(e.$t("header.searchButton")),1)]),_:1},8,["onClick"]),r(p,{type:e.searchForm.isMark?"primary":"default",onClick:e.handleSearchMark},{default:i(()=>[f(a(e.$t("order.toolbar.starred")),1)]),_:1},8,["type","onClick"])]),n("div",ke,[r(q,{data:e.orders,onSelectionChange:e.handleSelectionChange,style:{width:"100%"},"row-class-name":e.tableRowClassName},{default:i(()=>[e.status===1?(l(),k(m,{key:0,type:"selection",width:"55"})):d("",!0),r(m,{prop:"userNo",label:e.$t("order.card.customerCode"),width:"100"},null,8,["label"]),r(m,{prop:"userNo",label:e.$t("package.table.addressInfo"),width:"320"},{default:i(({row:t})=>[n("div",he,[n("div",null,[n("div",null,a(e.$t("customers.info.name"))+"："+a(t.userAddressInfo.firstName),1),n("div",null,a(e.$t("customers.info.postcode"))+"："+a(t.userAddressInfo.postcode),1),n("div",null,a(e.$t("customers.info.phoneNumber"))+"："+a(t.userAddressInfo.mobile),1),n("div",null,a(e.$t("customers.info.email"))+"："+a(t.userAddressInfo.email),1),n("div",null,a(e.$t("customers.info.address"))+"："+a(t.userAddressInfo.countryName)+" "+a(t.userAddressInfo.provinceName)+" "+a(t.userAddressInfo.cityName)+" "+a(t.userAddressInfo.address),1)])])]),_:1},8,["label"]),r(m,{prop:"logisticsNumber",width:"350",label:e.$t("package.table.expressDelivery")},{default:i(({row:t})=>[t.status<10?(l(),c("div",ve,[n("div",null,a(e.$t("order.card.trackingNo"))+"："+a(t.logisticsNumber),1),r(I,{width:800},{reference:i(()=>[t.trackingList&&t.trackingList.length>0?(l(),c("div",ye,a(e.$t("order.card.latestTracking"))+"："+a(e.formatTitleC(t.trackingList[0],"logisticsDesc","en")),1)):d("",!0)]),default:i(()=>[n("div",fe,[r(T,null,{default:i(()=>[(l(!0),c(O,null,A(t.trackingList,(o,b)=>(l(),k(z,{key:b,timestamp:o.gmtTime,placement:"top"},{default:i(()=>[n("p",null,a(e.formatTitleC(o,"logisticsDesc","en")),1)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)])]),_:2},1024),n("div",Ce,[(l(!0),c(O,null,A(t.imgUrlList,(o,b)=>(l(),c("div",{key:o,class:"block"},[r(D,{class:"image-list-item",style:{width:"60px",height:"60px"},"close-on-press-escape":"","preview-teleported":"",src:o,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":t.imgUrlList,"initial-index":b,"z-index":8,fit:"cover"},null,8,["src","preview-src-list","initial-index"])]))),128))])])):(l(),c("div",be,[n("div",null,[n("div",null,a(e.$t("package.table.sending_country"))+"："+a(t.receiverCountry),1),t.transhipmentTrackingNo?(l(),c("div",$e,a(e.$t("order.card.trackingNo2"))+"："+a(t.transhipmentTrackingNo),1)):d("",!0),n("div",null,a(e.$t("order.card.sendLine"))+"："+a(e.formatTitleC(t,"logisticsLine","en")),1),r(I,{width:800},{reference:i(()=>[t.trackingList&&t.trackingList.length>0?(l(),c("div",Se,a(e.$t("order.card.latestTracking"))+"："+a(e.formatTitleC(t.trackingList[0],"trackDesc","trans")),1)):d("",!0)]),default:i(()=>[n("div",Fe,[r(T,null,{default:i(()=>[(l(!0),c(O,null,A(t.trackingList,(o,b)=>(l(),k(z,{key:b,timestamp:o.pathTime,placement:"top"},{default:i(()=>[n("p",null,a(e.formatTitleC(o,"trackDesc","trans")),1)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)])]),_:2},1024),n("div",Pe,[(l(!0),c(O,null,A(t.imgUrlList,(o,b)=>(l(),c("div",{key:o,class:"block"},[r(D,{class:"image-list-item",style:{width:"60px",height:"60px"},"close-on-press-escape":"","preview-teleported":"",src:o,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":t.imgUrlList,"initial-index":b,"z-index":"8",fit:"cover"},null,8,["src","preview-src-list","initial-index"])]))),128))])])]))]),_:1},8,["label"]),e.status>9?(l(),k(m,{key:1,prop:"packageInfo",width:"250",label:e.$t("package.table.packageInfo")},{default:i(({row:t})=>[n("div",null,[n("span",{class:M(["tip",e.status>11?"overline":""])},a(e.$t("package.table.estimateSize"))+": "+a(t.estimatePackageSizeDTO.length)+"*"+a(t.estimatePackageSizeDTO.width)+"*"+a(t.estimatePackageSizeDTO.height)+"cm",3)]),e.status>11?(l(),c("div",Ne,[n("span",_e,a(e.$t("package.table.realSize"))+": "+a(t.realPackageSizeDTO.length)+"*"+a(t.realPackageSizeDTO.width)+"*"+a(t.realPackageSizeDTO.height)+"cm",1)])):d("",!0),n("div",null,[n("span",{class:M(["tip",e.status>11?"overline":""])},a(e.$t("package.table.estimateWeight"))+": "+a(t.estimatePackageSizeDTO.weight)+"g",3)]),e.status>11?(l(),c("div",ze,[n("span",Te,a(e.$t("package.table.realWeight"))+": "+a(t.realPackageSizeDTO.weight)+"g",1)])):d("",!0),n("div",null,[n("span",{class:M(["tip",t.realFreightDeposit?"overline":""])},a(e.$t("package.table.estimateFreight"))+": "+a(e.formatPriceC(t,"freightDeposit")),3)]),t.realFreightDeposit?(l(),c("div",Ie,[n("span",De,a(e.$t("package.table.realFreight"))+": "+a(e.formatPriceC(t,"realFreightDeposit")),1)])):d("",!0),t.insuranceFee?(l(),c("div",Le,[n("span",Oe,a(e.$t("package.table.insuranceFee"))+": "+a(e.formatPriceC(t,"insuranceFee")),1)])):d("",!0),t.packageDeclaredPrice?(l(),c("div",Ae,[n("span",Me,a(e.$t("package.table.declarationPrice"))+": $"+a(t.packageDeclaredPrice/100),1)])):d("",!0)]),_:1},8,["label"])):d("",!0),e.status<10?(l(),k(m,{key:2,prop:"gmtCreate",label:e.$t("commont.createTime"),width:"100"},null,8,["label"])):d("",!0),r(m,{prop:"statusDesc",label:e.$t("package.table.latestStatus"),width:"100"},{default:i(({row:t})=>[r(V,null,{default:i(()=>[f(a(e.formatTitleC(t,"statusDesc","en"))+" ",1),t.debtUserPayId?(l(),k(U,{key:0,content:e.$t("package.table.package_bk_order_status_tip"),placement:"top"},{default:i(()=>[r(v,{class:"help-icon"},{default:i(()=>[r(C,{style:{color:"#d9d9d9"}})]),_:1})]),_:1},8,["content"])):d("",!0)]),_:2},1024)]),_:1},8,["label"]),r(m,{label:e.$t("commont.operation"),width:"200",align:"center"},{default:i(({row:t})=>[n("div",null,[e.status!=10?(l(),k(p,{key:0,type:"primary",link:!0,class:"star-btn",onClick:o=>e.handleStarClick(t)},{default:i(()=>[f(a(e.$t("commont.share")),1)]),_:2},1032,["onClick"])):d("",!0)]),n("div",null,[e.status!=10?(l(),k(p,{key:0,type:"primary",link:!0,class:"star-btn",onClick:o=>e.handleMarkClick(t)},{default:i(()=>[f(a(t.isMark?e.$t("package.cancelSpecialFocus"):e.$t("package.specialFocus")),1)]),_:2},1032,["onClick"])):d("",!0)]),n("div",null,[t.userPayId?(l(),k(p,{key:0,type:"primary",link:!0,class:"star-btn",onClick:o=>e.handlePayClick(t)},{default:i(()=>[f(a(e.$t("package.table.goPay")),1)]),_:2},1032,["onClick"])):d("",!0)]),n("div",null,[t.debtUserPayId?(l(),k(p,{key:0,type:"primary",link:!0,class:"star-btn",onClick:o=>e.handleDebtPayClick(t)},{default:i(()=>[f(a(e.$t("package.table.goPay")),1)]),_:2},1032,["onClick"])):d("",!0)]),n("div",null,[t.status===10?(l(),k(p,{key:0,type:"primary",link:!0,class:"star-btn",onClick:o=>e.handleCancelClick(t)},{default:i(()=>[f(a(e.$t("package.table.cancelPackage")),1)]),_:2},1032,["onClick"])):d("",!0)]),n("div",null,[t.status>=10?(l(),k(p,{key:0,type:"primary",link:!0,class:"star-btn",onClick:o=>e.handlePackageClick(t)},{default:i(()=>[f(a(e.$t("package.table.detail")),1)]),_:2},1032,["onClick"])):d("",!0)])]),_:1},8,["label"])]),_:1},8,["data","onSelectionChange","row-class-name"])]),e.status===1&&e.orders.length?(l(),c("div",Ue,[r(p,{type:"primary",onClick:e.handleSendSubmit},{default:i(()=>[f(a(e.$t("package.oneClickDelivery")),1)]),_:1},8,["onClick"])])):d("",!0),n("div",Ve,[n("div",qe,a(e.$t("commont.total"))+" "+a(e.total)+" "+a(e.$t("commont.page")),1),r(B,{"current-page":e.pagination.currentPage,"onUpdate:currentPage":h[2]||(h[2]=t=>e.pagination.currentPage=t),"page-size":e.pagination.pageSize,"onUpdate:pageSize":h[3]||(h[3]=t=>e.pagination.pageSize=t),"page-sizes":[10,20,50],total:e.total,layout:"prev, pager, next, sizes",onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])}const Ke=re(de,[["render",Be],["__scopeId","data-v-07acbb97"]]);export{Ke as default};
