import{r as b}from"./request-Db42XEdn.js";import{_ as Y,r as s,m as j,c as A,o as k,a as l,w as t,e as u,X as G,D as H,q as c,i as E,x as J,d as K,Y as O,E as x}from"./index-CeCSaknX.js";import"./currency-DoSCd0KH.js";const V={getUsers(n){return b({url:"/api/users",method:"get",params:n})},createUser(n){return b({url:"/api/users",method:"post",data:n})},updateUser(n,d){return b({url:`/api/users/${n}`,method:"put",data:d})},deleteUser(n){return b({url:`/api/users/${n}`,method:"delete"})}},Q={class:"user-list"},W={class:"dialog-footer"},Z={__name:"UserList",setup(n){const d=s(!1),z=s([]),q=s(0),g=s(1),U=s(10),f=s({username:""}),i=s(!1),_=s("edit"),o=s({id:"",username:"",email:"",password:""}),C=s(!1),F={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},m=async()=>{d.value=!0;try{const r=await V.getUsers({page:g.value,pageSize:U.value,...f.value});z.value=r.list,q.value=r.total}finally{d.value=!1}},L=()=>{g.value=1,m()},S=()=>{m()},$=r=>{_.value="edit",i.value=!0,o.value={...r}},D=async()=>{editFormRef.value&&await editFormRef.value.validate(async r=>{if(r){C.value=!0;try{_.value==="edit"?(await V.updateUser(o.value.id,o.value),x.success("更新成功")):(await V.createUser(o.value),x.success("创建成功")),i.value=!1,m()}catch(e){console.error("保存失败:",e)}finally{C.value=!1}}})},N=async r=>{try{await O.confirm("确认删除该用户吗？","提示",{type:"warning"}),await V.deleteUser(r.id),x.success("删除成功"),m()}catch(e){console.error("删除失败:",e)}};return j(()=>{m()}),(r,e)=>{const w=u("el-input"),p=u("el-form-item"),v=u("el-button"),B=u("el-form"),y=u("el-table-column"),R=u("el-table"),M=u("el-pagination"),T=u("el-card"),P=u("el-dialog"),I=G("loading");return k(),A("div",Q,[l(T,null,{default:t(()=>[l(B,{inline:!0,model:f.value},{default:t(()=>[l(p,{label:"用户名"},{default:t(()=>[l(w,{modelValue:f.value.username,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value.username=a),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(p,null,{default:t(()=>[l(v,{type:"primary",onClick:L},{default:t(()=>e[8]||(e[8]=[c("搜索")])),_:1})]),_:1})]),_:1},8,["model"]),H((k(),E(R,{data:z.value},{default:t(()=>[l(y,{prop:"username",label:"用户名"}),l(y,{prop:"email",label:"邮箱"}),l(y,{prop:"createTime",label:"创建时间"}),l(y,{label:"操作"},{default:t(a=>[l(v,{type:"primary",size:"small",onClick:X=>$(a.row)},{default:t(()=>e[9]||(e[9]=[c(" 编辑 ")])),_:2},1032,["onClick"]),l(v,{type:"danger",size:"small",onClick:X=>N(a.row)},{default:t(()=>e[10]||(e[10]=[c(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,d.value]]),l(M,{"current-page":g.value,"onUpdate:currentPage":e[1]||(e[1]=a=>g.value=a),"page-size":U.value,"onUpdate:pageSize":e[2]||(e[2]=a=>U.value=a),total:q.value,onCurrentChange:S},null,8,["current-page","page-size","total"])]),_:1}),l(P,{modelValue:i.value,"onUpdate:modelValue":e[7]||(e[7]=a=>i.value=a),title:_.value==="edit"?"编辑用户":"新增用户",width:"500px"},{footer:t(()=>[K("span",W,[l(v,{onClick:e[6]||(e[6]=a=>i.value=!1)},{default:t(()=>e[11]||(e[11]=[c("取消")])),_:1}),l(v,{type:"primary",onClick:D,loading:C.value},{default:t(()=>e[12]||(e[12]=[c(" 确定 ")])),_:1},8,["loading"])])]),default:t(()=>[l(B,{ref:"editFormRef",model:o.value,rules:F,"label-width":"80px"},{default:t(()=>[l(p,{label:"用户名",prop:"username"},{default:t(()=>[l(w,{modelValue:o.value.username,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.username=a)},null,8,["modelValue"])]),_:1}),l(p,{label:"邮箱",prop:"email"},{default:t(()=>[l(w,{modelValue:o.value.email,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.email=a)},null,8,["modelValue"])]),_:1}),_.value==="add"?(k(),E(p,{key:0,label:"密码",prop:"password"},{default:t(()=>[l(w,{modelValue:o.value.password,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.password=a),type:"password","show-password":""},null,8,["modelValue"])]),_:1})):J("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ae=Y(Z,[["__scopeId","data-v-67a77176"]]);export{ae as default};
