import{_ as te,r as v,o as ae,a as oe,c as h,b as u,e as s,d as r,t as n,w as o,f as i,F as I,k as L,u as re,j as c,l as $,m as U,h as k,s as le,q as H,p as q,E as b}from"./index-CAD5YEHZ.js";import{A as ne,t as S}from"./AddressForm-OYLk7KNn.js";import{u as de}from"./auth-BVoTKOlD.js";import{C as ue}from"./CommonHeader-BqF9ZdEA.js";import"./request-Ci6vZ18k.js";import"./logo-9lYzFWJC.js";const ie={class:"add-transfer"},ce={class:"content"},me={class:"page-header"},fe={class:"title"},pe={class:"section warehouse-section"},ve={class:"section-title"},_e={class:"section-content"},he={class:"section-tip"},ge={class:"order-header"},ke={class:"order-title"},be={class:"order-content"},ye={class:"info-section"},Ce={class:"section-title"},Ae={class:"section-content"},$e={class:"recent-address"},Ne={class:"address-text"},Oe={class:"info-section"},we={class:"section-title"},Ve={class:"section-content"},Ie={class:"add-express"},Le={class:"add-order-section"},Ue={class:"submit-section"},Se={__name:"AddTransferOrder",setup(Te){re(),de();const z=v(""),N=v(!1),y=v(!1),m=v(0),O=v(!1),C=v([]),M=async e=>{if(e){O.value=!0;try{const a=await S.subUserList({userNo:e,pageSize:100,pageNo:1});C.value=a.data.map(_=>({..._,value:_.userNo,label:_.userNo}))}catch(a){console.error("搜索失败:",a),b.error("搜索失败")}finally{O.value=!1}}else C.value=[]},j=e=>{console.log(t.value[e].userNo),C.value.map(a=>{a.value===t.value[e].userNo&&(t.value[e].recentAddress=`${a.userAddressInfo.firstName}, ${a.userAddressInfo.address}, ${a.userAddressInfo.mobile}`,t.value[e].userAddressInfo=a.userAddressInfo,t.value[e].userAddressId=a.userAddressInfo.id)})},w=()=>({userNo:"",recentAddress:"",userAddressId:"",userAddressInfo:{},trackingInfoList:[{trackingNumber:"",price:"",images:[]}]}),t=v([w()]),T=()=>{const e=new Date;z.value=e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")};let V=null;ae(()=>{T(),V=setInterval(T,1e3)}),oe(()=>{V&&clearInterval(V)});const R=()=>{b.info("请联系在线客服获取仓库地址")},W=async()=>{try{const e=await S.getCustomCode();t.value[m.value].userNo=e.data,t.value[m.value].recentAddress="",t.value[m.value].userAddressInfo={},t.value[m.value].userAddressId=""}catch{b.error("获取自定义编码失败")}},G=e=>{m.value=e,y.value=!0},J=e=>{t.value[m.value].recentAddress=`${e.name}, ${e.address}, ${e.mobile}`,t.value[m.value].userAddressInfo=e,y.value=!1},K=e=>{t.value[e].trackingInfoList.push({trackingNumber:"",price:"",images:[]})},P=(e,a)=>{t.value[e].trackingInfoList.length>1&&t.value[e].trackingInfoList.splice(a,1)},Q=async()=>{N.value=!0;try{console.log("提交的订单数据:",t.value);const e={};e.transportDataList=t.value,await S.submitTpOrder(e),b.success("提交成功"),t.value=[w()]}catch(e){console.error("提交失败:",e),b.error("提交失败")}finally{N.value=!1}},X=()=>{t.value.push(w())},Y=e=>{t.value.length>1&&t.value.splice(e,1)};return(e,a)=>{const _=i("el-link"),Z=i("el-alert"),f=i("el-button"),x=i("el-option"),g=i("el-icon"),ee=i("el-select"),E=i("el-tooltip"),D=i("el-form-item"),se=i("el-form"),B=i("el-input");return u(),h("div",ie,[s(ue),r("div",ce,[r("div",me,[r("div",fe,n(e.$t("transfer.addOrder.title")),1),s(_,{type:"primary",onClick:a[0]||(a[0]=d=>e.$router.push("/orders"))},{default:o(()=>[c(n(e.$t("transfer.addOrder.backToList")),1)]),_:1})]),r("div",pe,[r("div",ve,n(e.$t("transfer.addOrder.warehouse.title")),1),r("div",_e,[s(_,{type:"primary",onClick:R},{default:o(()=>[c(n(e.$t("transfer.addOrder.warehouse.getAddress")),1)]),_:1})]),r("div",he,[s(Z,{type:"warning",closable:!1,"show-icon":""},{default:o(()=>[c(n(e.$t("transfer.addOrder.warehouse.tip")),1)]),_:1})])]),(u(!0),h(I,null,L(t.value,(d,p)=>(u(),h("div",{key:p,class:"order-group"},[r("div",ge,[r("div",ke,"转运订单 #"+n(p+1),1),t.value.length>1?(u(),$(f,{key:0,type:"danger",link:"",onClick:l=>Y(p)},{default:o(()=>a[2]||(a[2]=[c(" 删除此订单 ")])),_:2},1032,["onClick"])):U("",!0)]),r("div",be,[r("div",ye,[r("div",Ce,n(e.$t("transfer.addOrder.form.title")),1),r("div",Ae,[s(se,{model:d,"label-width":"120px"},{default:o(()=>[s(D,{label:e.$t("transfer.addOrder.form.customCode"),required:""},{default:o(()=>[s(ee,{modelValue:d.userNo,"onUpdate:modelValue":l=>d.userNo=l,filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入关键词搜索","remote-method":M,loading:O.value,onChange:l=>j(p),class:"custom-code-select"},{prefix:o(()=>[s(g,null,{default:o(()=>[s(k(le))]),_:1})]),default:o(()=>[(u(!0),h(I,null,L(C.value,l=>(u(),$(x,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","loading","onChange"]),s(f,{type:"primary",plain:"",onClick:W},{default:o(()=>[c(n(e.$t("transfer.addOrder.form.customCodeHelp")),1)]),_:1}),s(E,{content:"编码说明",placement:"top",class:"custom-code-help"},{default:o(()=>[s(g,null,{default:o(()=>[s(k(H))]),_:1})]),_:1})]),_:2},1032,["label"]),s(D,{label:e.$t("transfer.addOrder.form.recentAddress")},{default:o(()=>[r("div",$e,[r("span",Ne,n(d.recentAddress||e.$t("transfer.addOrder.form.noAddress")),1),d.userNo?(u(),$(f,{key:0,type:"primary",link:"",class:"add-address-btn",onClick:l=>G(p)},{default:o(()=>[c(n(d.userAddressId?e.$t("transfer.addOrder.form.editAddress"):e.$t("transfer.addOrder.form.addAddress"))+" ",1),s(E,{content:"地址说明",placement:"top"},{default:o(()=>[s(g,{class:"address-help"},{default:o(()=>[s(k(H))]),_:1})]),_:1})]),_:2},1032,["onClick"])):U("",!0)])]),_:2},1032,["label"])]),_:2},1032,["model"])])]),r("div",Oe,[r("div",we,n(e.$t("transfer.addOrder.form.expressTitle")),1),r("div",Ve,[(u(!0),h(I,null,L(d.trackingInfoList,(l,F)=>(u(),h("div",{key:F,class:"express-item"},[s(B,{modelValue:l.trackingNumber,"onUpdate:modelValue":A=>l.trackingNumber=A,placeholder:e.$t("transfer.addOrder.form.trackingNumber")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),s(B,{modelValue:l.price,"onUpdate:modelValue":A=>l.price=A,placeholder:e.$t("transfer.addOrder.form.value")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),d.trackingInfoList.length>1?(u(),$(f,{key:0,type:"danger",link:"",onClick:A=>P(p,F)},{default:o(()=>a[3]||(a[3]=[c(" 删除 ")])),_:2},1032,["onClick"])):U("",!0)]))),128)),r("div",Ie,[s(f,{type:"primary",plain:"",class:"add-btn",onClick:l=>K(p)},{default:o(()=>[s(g,null,{default:o(()=>[s(k(q))]),_:1}),c(" "+n(e.$t("transfer.addOrder.form.addExpress")),1)]),_:2},1032,["onClick"])])])])])]))),128)),r("div",Le,[s(f,{type:"primary",plain:"",class:"add-order-btn",onClick:X},{default:o(()=>[s(g,null,{default:o(()=>[s(k(q))]),_:1}),a[4]||(a[4]=c(" 添加新的转运订单 "))]),_:1})]),r("div",Ue,[s(f,{type:"primary",loading:N.value,onClick:Q},{default:o(()=>[c(n(e.$t("transfer.addOrder.form.submit")),1)]),_:1},8,["loading"])])]),s(ne,{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=d=>y.value=d),subCode:t.value[m.value].userNo,formData:t.value[m.value],onSubmit:J},null,8,["modelValue","subCode","formData"])])}}},ze=te(Se,[["__scopeId","data-v-7a3db60e"]]);export{ze as default};
