import{r as p}from"./request-Ci6vZ18k.js";import{_ as H,r as i,W as g,o as J,l as F,b as v,w as s,f as n,E as c,e as o,a6 as W,j as $,t as h,c as T,F as k,k as B,d as z}from"./index-CAD5YEHZ.js";const y={country(d){return p({url:"/app/area/listByLevel",method:"get",params:d})},province(d){return p({url:"/app/area/listByParentId",method:"get",params:d})},addUserAddress(d){return p({url:"/app/userAddress/add",method:"post",data:d})},updateUserAddress(d){return p({url:"/app/userAddress/update",method:"post",data:d})},getCustomCode(d){return p({url:"/app/user/randomUserNO",method:"get",params:d})},submitTpOrder(d){return p({url:"/app/tp/order/submitTpOrder",method:"post",data:d})},subUserList(d){return p({url:"/app/user/subUserList",method:"post",data:d})}},G={class:"dialog-footer"},K={__name:"AddressForm",props:{modelValue:{type:Boolean,default:!1},subCode:{type:String,default:""},formData:{type:Object,default:()=>{}}},emits:["update:modelValue","submit"],setup(d,{emit:q}){const t=d,I=q,V=i(null),C=i(!1),D=i(""),a=i({name:"",address:"",mobile:"",countryId:"",provinceId:"",cityName:"",postcode:"",subCode:""}),b=i(!1);g(()=>t.modelValue,l=>{b.value=l,a.value={},t.subCode&&(a.value.subCode=t.subCode),t.formData.userAddressInfo&&(a.value={...t.formData.userAddressInfo},a.value.name=t.formData.userAddressInfo.firstName,a.value.subCode=t.subCode)}),g(()=>b.value,l=>{I("update:modelValue",l)});const _=i([]),N=i([]),L={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],address:[{required:!0,message:"请输入地址",trigger:"blur"}],mobile:[{required:!0,message:"请输入电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],countryId:[{required:!0,message:"请选择国家",trigger:"blur"}],provinceId:[{required:!0,message:"请选择省份",trigger:"blur"}],postcode:[{required:!0,message:"请输入邮编",trigger:"blur"},{pattern:/^\d{6}$/,message:"请输入正确的邮政编码",trigger:"blur"}]},O=async()=>{try{const l=await y.country({areaLevel:1});_.value=l.data.map(e=>({value:e.id,label:e.areaName}))}catch(l){console.error("获取国家列表失败:",l),c.error("获取国家列表失败")}},S=async l=>{try{const e=await y.province({parentId:l});N.value=e.data.map(f=>({value:f.id,label:f.areaName}))}catch(e){console.error("获取省份列表失败:",e),c.error("获取省份列表失败")}},E=async()=>{try{const l=await y.getCustomCode();a.value.subCode=l.data}catch{c.error("获取自定义编码失败")}};g(D,async l=>{if(l)try{setTimeout(()=>{const e={name:"张三",address:"北京市朝阳区xxx街道xxx号",mobile:"13800138000",country:"CN",province:"BJ",cityName:"北京",postcode:"100000"};a.value=e,c.success("地址解析成功")},500)}catch(e){console.error("地址解析失败:",e),c.error("地址解析失败")}}),g(()=>a.value.countryId,async l=>{l&&await S(l)});const R=async()=>{V.value&&await V.value.validate(async l=>{if(l){C.value=!0;try{console.log(a.value);const e=a.value;e.firstName=e.name,e.lastName=e.name,e.subCode=e.subCode!==""?e.subCode:t.subCode,t.formData.addressId?(e.addressId=t.formData.addressId,await y.updateUserAddress(e)):await y.addUserAddress(e),I("submit",a.value),c.success("保存成功"),b.value=!1}catch(e){console.error("保存失败:",e),c.error("保存失败")}finally{C.value=!1}}})};return J(()=>{O()}),(l,e)=>{const f=n("el-button"),m=n("el-input"),u=n("el-form-item"),U=n("el-col"),w=n("el-option"),A=n("el-select"),j=n("el-row"),M=n("el-form"),P=n("el-dialog");return v(),F(P,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=r=>b.value=r),title:l.$t("addressForm.title"),width:"800px","close-on-click-modal":!1},{footer:s(()=>[z("span",G,[o(f,{onClick:e[9]||(e[9]=r=>b.value=!1)},{default:s(()=>[$(h(l.$t("submit.global_cancel")),1)]),_:1}),o(f,{type:"primary",onClick:R,loading:C.value},{default:s(()=>[$(h(l.$t("submit.gloabl_confirm")),1)]),_:1},8,["loading"])])]),default:s(()=>[o(M,{ref_key:"formRef",ref:V,model:a.value,rules:L,"label-width":"80px",class:"address-form"},{default:s(()=>[o(j,{gutter:20},{default:s(()=>[o(U,{span:12},{default:s(()=>[o(u,{label:l.$t("addressForm.customerCode"),prop:"subCode"},{default:s(()=>[o(m,{disabled:!!t.subCode,modelValue:a.value.subCode,"onUpdate:modelValue":e[0]||(e[0]=r=>a.value.subCode=r),placeholder:l.$t("addressForm.customerCodeTip")},W({_:2},[t.subCode?void 0:{name:"append",fn:s(()=>[o(f,{class:"primary-btn",type:"primary",onClick:E},{default:s(()=>[$(h(l.$t("addressForm.customCodeRandom")),1)]),_:1})]),key:"0"}]),1032,["disabled","modelValue","placeholder"])]),_:1},8,["label"]),o(u,{label:l.$t("addressForm.name"),prop:"name"},{default:s(()=>[o(m,{modelValue:a.value.name,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.name=r),placeholder:l.$t("addressForm.nameTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(u,{label:l.$t("addressForm.address"),prop:"address"},{default:s(()=>[o(m,{modelValue:a.value.address,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.address=r),placeholder:l.$t("addressForm.addressTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(u,{label:l.$t("addressForm.email"),prop:"email"},{default:s(()=>[o(m,{modelValue:a.value.email,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.email=r),placeholder:l.$t("addressForm.emailTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(u,{label:l.$t("addressForm.phoneNumber"),prop:"mobile"},{default:s(()=>[o(m,{modelValue:a.value.mobile,"onUpdate:modelValue":e[4]||(e[4]=r=>a.value.mobile=r),placeholder:l.$t("addressForm.phoneNumberTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),o(U,{span:12},{default:s(()=>[o(u,{label:l.$t("addressForm.country"),prop:"countryId"},{default:s(()=>[o(A,{modelValue:a.value.countryId,"onUpdate:modelValue":e[5]||(e[5]=r=>a.value.countryId=r),placeholder:l.$t("addressForm.countryTip"),filterable:""},{default:s(()=>[(v(!0),T(k,null,B(_.value,r=>(v(),F(w,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),o(u,{label:l.$t("addressForm.province"),prop:"provinceId"},{default:s(()=>[o(A,{modelValue:a.value.provinceId,"onUpdate:modelValue":e[6]||(e[6]=r=>a.value.provinceId=r),placeholder:l.$t("addressForm.provinceTip"),filterable:""},{default:s(()=>[(v(!0),T(k,null,B(N.value,r=>(v(),F(w,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),o(u,{label:l.$t("addressForm.city"),prop:"cityName"},{default:s(()=>[o(m,{modelValue:a.value.cityName,"onUpdate:modelValue":e[7]||(e[7]=r=>a.value.cityName=r),placeholder:l.$t("addressForm.cityTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(u,{label:l.$t("addressForm.postCode"),prop:"postcode"},{default:s(()=>[o(m,{modelValue:a.value.postcode,"onUpdate:modelValue":e[8]||(e[8]=r=>a.value.postcode=r),placeholder:l.$t("addressForm.postCodeTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},Y=H(K,[["__scopeId","data-v-1ee7924a"]]);export{Y as A,y as t};
