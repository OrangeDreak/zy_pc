import{a as A}from"./orderList-DHwY1C9a.js";import{C as Y,D as Z,G as B,r as N,a3 as x,v as ee,H as te,E as I,u as ae,a2 as se,_ as ne,d,o,f as n,y as m,F as M,j as O,e as r,i as v,w as i,q as a,L as R,g as C,n as y}from"./index-TAmHM2dm.js";import"./request-tfwnRnxz.js";import"./currency-BJx3poTv.js";const le=Y({name:"OrderList",setup(){const e=ae(),u=te(),{proxy:k}=Z(),V=({row:s})=>s.isMark?"status-mark":"",L=B({currentPage:1,pageSize:10}),z=B({userNo:"",trackingNo:"",isMark:0}),D=N([]),p=N(0),h=N(!1),_=N(null),P=N({}),f=N(-1),g=N([]),T=x(()=>[{status:-1,icon:"icon-all",label:k.$t("package.status.all"),count:"allOrder"},{status:0,icon:"icon-recorded",label:k.$t("package.status.recorded"),count:"enterCount"},{status:1,icon:"icon-qc",label:k.$t("package.status.qc"),count:"qcCount"},{status:10,icon:"icon-shipped",label:k.$t("package.status.waitPay"),count:"waitPayCount"},{status:11,icon:"icon-processing",label:k.$t("package.status.processing"),count:"waitSendCount"},{status:12,icon:"icon-delivered",label:k.$t("package.status.delivered"),count:"sendCount"},{status:13,icon:"icon-finished",label:k.$t("package.status.finished"),count:"signCount"}]);ee(()=>{u.query.userNo&&(z.userNo=u.query.userNo),b()});const U=async s=>{g.value=s},E=async()=>{e.push("/estimate")},t=async()=>{if(g.value.length===0){I.error(k.$t("order.orderSelectTip"));return}if(g.value.length>0){const S=g.value[0].userNo;if(!g.value.every(X=>X.userNo===S)){I.error("所选订单的用户编号不一致");return}}let s=g.value[0].userNo,c=!0;if(g.value.forEach(S=>{S.userNo!==s&&(c=!1)}),!c){I.error(k.$t("order.orderNotSameUserTip"));return}const F=g.value.map(S=>S.id);console.log(F),sessionStorage.setItem("SubOrderIds",F),e.push("/submit-transfer")},l=s=>{e.push("/package-detail?id="+s.id)},$=s=>{e.push({path:"/pay",query:{payType:3,userPayId:s.userPayId||void 0,source:"package-list"}})},w=async s=>{try{await se.confirm("确认取消包裹订单吗？","提示",{type:"warning"}).then(async()=>{await A.packageOrderCancel({packageOrderId:s.id,cancelReason:"cancel"}).then(c=>{c.code===200&&b()})})}catch(c){console.error("删除失败:",c)}},b=async()=>{try{h.value=!0,_.value=null;let s={pageNo:L.currentPage,pageSize:L.pageSize,...z};s.isMark||delete s.isMark,D.value=[];let c="getOrderList";f.value<10?(s.status=f.value,f.value===-1&&delete s.status,c="getOrderList"):(s.status=f.value,c="myPackageOrderList");const F=await A[c](s);D.value=F.data,p.value=F.total}catch(s){_.value=s.message||"获取订单失败",I.error("获取订单列表失败")}finally{h.value=!1}},j=()=>{b()},G=()=>{z.isMark=z.isMark?0:1,b()},q=async()=>{try{const s=await A.getOrderCount();P.value=s.data}catch{}},H=s=>{L.pageSize=s,b()},J=s=>{L.currentPage=s,b()},K=async s=>{const{data:c}=await A.updateAttentionMark({tpSubOrderId:s.id,isMark:s.isMark?0:1});I.success("特别关注状态更新成功"),b()},Q=async s=>{const{data:c}=await A.getSharingCode({userNo:s.userNo,orderId:s.id}),F=`${window.location.origin}/order-share-transfer?code=${c}`;navigator.clipboard.writeText(F).then(()=>{console.log("内容已成功复制到剪切板")}).catch(S=>{console.error("无法复制内容到剪切板:",S)}),I.success("分享订单成功")},W=s=>{f.value=s,b()};return q(),{searchForm:z,orders:D,total:p,pagination:L,status:f,flowItems:T,selectedOrders:g,countList:P,handleSizeChange:H,handleCurrentChange:J,handleFlowItemClick:W,handleStarClick:Q,handleMarkClick:K,handleSelectionChange:U,handleSendSubmit:t,handleEstimate:E,getCountList:q,handleSearch:j,handleSearchMark:G,tableRowClassName:V,handlePackageClick:l,handlePayClick:$,handleCancelClick:w}}}),oe={class:"order-list"},ie={class:"order-flow"},re=["onClick"],ue={class:"search-toolbar"},ce={class:"order-list-content"},de={class:"user-info"},pe={key:0},ge={key:0},me={class:"timeline"},ke={class:"image-list"},he={key:1,class:"estimate-info"},ve={key:0},fe={class:"timeline"},Ce={key:0},ye={key:0,class:"btn-box"},be={class:"pagination"},$e={class:"total"};function Fe(e,u,k,V,L,z){const D=v("el-input"),p=v("el-button"),h=v("el-table-column"),_=v("el-timeline-item"),P=v("el-timeline"),f=v("el-popover"),g=v("el-image"),T=v("el-tag"),U=v("el-table"),E=v("el-pagination");return o(),d("div",oe,[n("div",ie,[(o(!0),d(M,null,O(e.flowItems,t=>(o(),d("div",{key:t.status,class:R(["flow-item",{active:t.status===e.status}]),onClick:l=>e.handleFlowItemClick(t.status)},[n("i",{class:R(t.icon)},null,2),n("span",null,a(t.label)+"("+a(e.countList[t.count])+")",1)],10,re))),128))]),n("div",ue,[r(D,{modelValue:e.searchForm.trackingNo,"onUpdate:modelValue":u[0]||(u[0]=t=>e.searchForm.trackingNo=t),placeholder:e.$t("order.toolbar.trackingSearch"),class:"search-input"},null,8,["modelValue","placeholder"]),r(D,{modelValue:e.searchForm.userNo,"onUpdate:modelValue":u[1]||(u[1]=t=>e.searchForm.userNo=t),placeholder:e.$t("order.toolbar.customerSearch"),class:"search-input"},null,8,["modelValue","placeholder"]),r(p,{onClick:e.handleSearch},{default:i(()=>[C(a(e.$t("header.searchButton")),1)]),_:1},8,["onClick"]),r(p,{type:e.searchForm.isMark?"primary":"default",onClick:e.handleSearchMark},{default:i(()=>[C(a(e.$t("order.toolbar.starred")),1)]),_:1},8,["type","onClick"])]),n("div",ce,[r(U,{data:e.orders,onSelectionChange:e.handleSelectionChange,style:{width:"100%"},"row-class-name":e.tableRowClassName},{default:i(()=>[e.status===1?(o(),y(h,{key:0,type:"selection",width:"55"})):m("",!0),r(h,{prop:"userNo",label:e.$t("package.table.customerCode"),width:"100"},null,8,["label"]),r(h,{prop:"userNo",label:e.$t("package.table.addressInfo"),width:"320"},{default:i(({row:t})=>[n("div",de,[n("div",null,[n("div",null,a(e.$t("customers.info.name"))+"："+a(t.userAddressInfo.firstName),1),n("div",null,a(e.$t("customers.info.postcode"))+"："+a(t.userAddressInfo.postcode),1),n("div",null,a(e.$t("customers.info.phoneNumber"))+"："+a(t.userAddressInfo.mobile),1),n("div",null,a(e.$t("customers.info.email"))+"："+a(t.userAddressInfo.email),1),n("div",null,a(e.$t("customers.info.address"))+"："+a(t.userAddressInfo.countryName)+" "+a(t.userAddressInfo.provinceName)+" "+a(t.userAddressInfo.cityName)+" "+a(t.userAddressInfo.address),1)])])]),_:1},8,["label"]),r(h,{prop:"logisticsNumber",label:e.$t("package.table.expressDelivery")},{default:i(({row:t})=>[t.status<10?(o(),d("div",pe,[n("div",null,a(e.$t("trackingNumber"))+"："+a(t.logisticsNumber),1),r(f,{width:800},{reference:i(()=>{var l;return[t.trackingList&&t.trackingList.length>0?(o(),d("div",ge,a(e.$t("logisticsTrack"))+"："+a(t.trackingList&&((l=t.trackingList[0])==null?void 0:l.logisticsDesc)),1)):m("",!0)]}),default:i(()=>[n("div",me,[r(P,null,{default:i(()=>[(o(!0),d(M,null,O(t.trackingList,(l,$)=>(o(),y(_,{key:$,timestamp:l.gmtTime,placement:"top"},{default:i(()=>[n("p",null,a(l.logisticsDesc),1)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)])]),_:2},1024),n("div",ke,[(o(!0),d(M,null,O(t.imgUrlList,(l,$)=>(o(),d("div",{key:l,class:"block"},[r(g,{class:"image-list-item",style:{width:"60px",height:"60px"},"close-on-press-escape":"","preview-teleported":"",src:l,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":t.imgUrlList,"initial-index":$,"z-index":"8",fit:"cover"},null,8,["src","preview-src-list","initial-index"])]))),128))])])):(o(),d("div",he,[n("div",null,[n("div",null,"国际单号："+a(t.orderNo),1),n("div",null,"物流线路："+a(t.logisticsLine),1),r(f,{width:800},{reference:i(()=>{var l;return[t.trackingList&&t.trackingList.length>0?(o(),d("div",ve,a(e.$t("logisticsTrack"))+"："+a(t.trackingList&&((l=t.trackingList[0])==null?void 0:l.logisticsDesc)),1)):m("",!0)]}),default:i(()=>[n("div",fe,[r(P,null,{default:i(()=>[(o(!0),d(M,null,O(t.trackingList,(l,$)=>(o(),y(_,{key:$,timestamp:l.gmtTime,placement:"top"},{default:i(()=>[n("p",null,a(l.logisticsDesc),1)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)])]),_:2},1024),n("div",null,"包裹运费："+a(t.estimateFreightPrice),1)]),n("div",null,[n("div",null,a(t.estimatePackageSizeDTO.length)+"*"+a(t.estimatePackageSizeDTO.width)+"*"+a(t.estimatePackageSizeDTO.height),1),n("div",null,a(t.estimatePackageSizeDTO.weight)+"g",1),u[4]||(u[4]=n("div",null,"内含8件",-1)),u[5]||(u[5]=n("div",null,"在途 7 天",-1))])]))]),_:1},8,["label"]),e.status<10?(o(),y(h,{key:1,prop:"gmtCreate",label:e.$t("commont.createTime"),width:"100"},null,8,["label"])):m("",!0),r(h,{prop:"statusDesc",label:e.$t("package.table.latestStatus"),width:"100"},{default:i(({row:t})=>[r(T,null,{default:i(()=>[C(a(e.$i18n.locale==="en"?t.statusDescEn:t.statusDesc),1)]),_:2},1024)]),_:1},8,["label"]),r(h,{label:e.$t("commont.operation"),width:"200",align:"center"},{default:i(({row:t})=>[n("div",null,[e.status!=10?(o(),y(p,{key:0,type:"text",class:"star-btn",onClick:l=>e.handleStarClick(t)},{default:i(()=>[C(a(e.$t("commont.share")),1)]),_:2},1032,["onClick"])):m("",!0),e.status!=10?(o(),y(p,{key:1,type:"text",class:"star-btn",onClick:l=>e.handleMarkClick(t)},{default:i(()=>[C(a(t.isMark?e.$t("package.cancelSpecialFocus"):e.$t("package.specialFocus")),1)]),_:2},1032,["onClick"])):m("",!0)]),t.status>=0?(o(),d("div",Ce,[t.status>=10?(o(),y(p,{key:0,type:"text",class:"star-btn",onClick:l=>e.handlePackageClick(t)},{default:i(()=>[C(a(e.$t("package.table.detail")),1)]),_:2},1032,["onClick"])):m("",!0),t.status==10?(o(),y(p,{key:1,type:"text",class:"star-btn",onClick:l=>e.handlePayClick(t)},{default:i(()=>[C(a(e.$t("package.table.goPay")),1)]),_:2},1032,["onClick"])):m("",!0),t.status===10?(o(),y(p,{key:2,type:"text",class:"star-btn",onClick:l=>e.handleCancelClick(t)},{default:i(()=>u[6]||(u[6]=[C(" 取消包裹 ")])),_:2},1032,["onClick"])):m("",!0)])):m("",!0)]),_:1},8,["label"])]),_:1},8,["data","onSelectionChange","row-class-name"])]),e.status===1&&e.orders.length?(o(),d("div",ye,[r(p,{type:"primary",onClick:e.handleSendSubmit},{default:i(()=>[C(a(e.$t("package.oneClickDelivery")),1)]),_:1},8,["onClick"])])):m("",!0),n("div",be,[n("div",$e,a(e.$t("commont.total"))+" "+a(e.total)+" "+a(e.$t("commont.page")),1),r(E,{"current-page":e.pagination.currentPage,"onUpdate:currentPage":u[2]||(u[2]=t=>e.pagination.currentPage=t),"page-size":e.pagination.pageSize,"onUpdate:pageSize":u[3]||(u[3]=t=>e.pagination.pageSize=t),"page-sizes":[10,20,50],total:e.total,layout:"prev, pager, next, sizes",onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])}const Ie=ne(le,[["render",Fe],["__scopeId","data-v-6dff9df1"]]);export{Ie as default};
