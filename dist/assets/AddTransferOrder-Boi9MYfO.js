import{_ as re,r as h,m as ae,g as oe,n as le,c as g,o as f,a as r,d as a,t as n,w as o,e as m,F as I,f as U,q as v,i as N,v as S,h as C,s as ne,x as z,p as M,E as _}from"./index-BwAutTYV.js";import{A as de,t as T}from"./AddressForm-jAPrnjxl.js";import{u as ue}from"./currency-BaKDgkX2.js";import{C as ie}from"./CommonHeader-BRJFjOJH.js";import"./request-ChjQmMKM.js";import"./index-CubC8P_4.js";const ce={class:"add-transfer"},fe={class:"content"},me={class:"page-header"},pe={class:"title"},ve={class:"section warehouse-section"},_e={class:"section-title"},he={class:"section-tip"},ge={class:"order-header"},ke={class:"order-title"},$e={class:"order-content"},Ce={class:"info-section"},be={class:"section-title"},ye={class:"section-content"},Ae={class:"recent-address"},Ne={class:"address-text"},Oe={class:"info-section"},Ve={class:"section-title"},we={class:"section-content"},Le={class:"add-express"},Ie={class:"add-order-section"},Ue={class:"submit-section"},Se={__name:"AddTransferOrder",setup(Te){const j=oe(),q=ue(),Q=h(""),O=h(!1),b=h(!1),k=h(0),V=h(!1),y=h([]),R=async(e,s)=>{if(t.value[e].userNo=s,s){V.value=!0;try{const i=await T.subUserList({userNo:s,pageSize:100,pageNo:1});y.value=i.data.map(d=>({...d,value:d.userNo,label:d.userNo}))}catch(i){console.error("搜索失败:",i),_.error("搜索失败")}finally{V.value=!1}}else y.value=[]},G=e=>{console.log(111222,t.value[e].userNo),y.value.map(s=>{s.value===t.value[e].userNo&&(t.value[e].recentAddress=`${s.userAddressInfo.firstName}, ${s.userAddressInfo.address}, ${s.userAddressInfo.mobile}`,t.value[e].userAddressInfo=s.userAddressInfo,t.value[e].userAddressId=s.userAddressInfo.id)})},w=()=>({userNo:"",recentAddress:"",userAddressId:"",userAddressInfo:{},trackingInfoList:[{trackingNumber:"",price:"",images:[]}]}),t=h([w()]),D=()=>{const e=new Date;Q.value=e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")};let L=null;ae(()=>{D(),L=setInterval(D,1e3),q.token||j.push("/login")}),le(()=>{L&&clearInterval(L)});const J=async e=>{try{const s=await T.getCustomCode();t.value[e].userNo=s.data,t.value[e].recentAddress="",t.value[e].userAddressInfo={},t.value[e].userAddressId=""}catch{_.error("获取自定义编码失败")}},K=e=>{k.value=e,b.value=!0},P=e=>{t.value[k.value].recentAddress=`${e.name}, ${e.address}, ${e.mobile}`,t.value[k.value].userAddressInfo=e,b.value=!1},W=e=>{t.value[e].trackingInfoList.push({trackingNumber:"",price:"",images:[]})},X=(e,s)=>{t.value[e].trackingInfoList.length>1&&t.value[e].trackingInfoList.splice(s,1)},Y=async()=>{if((()=>{for(let s=0;s<t.value.length;s++){const i=t.value[s];if(!i.userNo)return _.error(`第 ${s+1} 个订单的用户编码不能为空`),!1;if(i.trackingInfoList.length===0)return _.error(`第 ${s+1} 个订单的快递单号列表不能为空`),!1;for(let d=0;d<i.trackingInfoList.length;d++){const c=i.trackingInfoList[d];if(!c.trackingNumber)return _.error(`第 ${s+1} 个订单的第 ${d+1} 个快递单号不能为空`),!1;if(!c.price)return _.error(`第 ${s+1} 个订单的第 ${d+1} 个快递单号的价格不能为空`),!1}}return!0})()){O.value=!0;try{console.log("提交的订单数据:",t.value);const s={};s.transportDataList=t.value,await T.submitTpOrder(s),_.success("提交成功"),t.value=[w()]}catch(s){console.error("提交失败:",s),_.error("提交失败")}finally{O.value=!1}}},Z=()=>{t.value.push(w())},x=e=>{t.value.length>1&&t.value.splice(e,1)};return(e,s)=>{const i=m("el-link"),d=m("el-alert"),c=m("el-button"),ee=m("el-option"),$=m("el-icon"),se=m("el-select"),E=m("el-tooltip"),H=m("el-form-item"),te=m("el-form"),B=m("el-input");return f(),g("div",ce,[r(ie),a("div",fe,[a("div",me,[a("div",pe,n(e.$t("transfer.addOrder.title")),1),r(i,{type:"primary",onClick:s[0]||(s[0]=u=>e.$router.push("/orders"))},{default:o(()=>[v(n(e.$t("transfer.addOrder.backToList")),1)]),_:1})]),a("div",ve,[a("div",_e,n(e.$t("transfer.addOrder.warehouse.title")),1),a("div",he,[r(d,{type:"warning",closable:!1,"show-icon":""},{default:o(()=>s[2]||(s[2]=[a("p",null,"联系人：QCelf",-1),a("p",null,"电话：17840804025",-1),a("p",null,"地址：广东省东莞市塘厦镇向阳路331号(佳邮国际进门左手边1楼)",-1)])),_:1})])]),(f(!0),g(I,null,U(t.value,(u,p)=>(f(),g("div",{key:p,class:"order-group"},[a("div",ge,[a("div",ke,n(e.$t("transfer.addOrder.order"))+" #"+n(p+1),1),t.value.length>1?(f(),N(c,{key:0,type:"danger",link:"",onClick:l=>x(p)},{default:o(()=>[v(n(e.$t("transfer.addOrder.deleteOrder")),1)]),_:2},1032,["onClick"])):S("",!0)]),a("div",$e,[a("div",Ce,[a("div",be,n(e.$t("transfer.addOrder.form.title")),1),a("div",ye,[r(te,{model:u,"label-width":"120px"},{default:o(()=>[r(H,{label:e.$t("transfer.addOrder.form.customCode"),required:""},{default:o(()=>[r(se,{modelValue:u.userNo,"onUpdate:modelValue":l=>u.userNo=l,filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入关键词搜索","remote-method":l=>R(p,l),loading:V.value,onChange:l=>G(p),class:"custom-code-select"},{prefix:o(()=>[r($,null,{default:o(()=>[r(C(ne))]),_:1})]),default:o(()=>[(f(!0),g(I,null,U(y.value,l=>(f(),N(ee,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","remote-method","loading","onChange"]),r(c,{type:"primary",plain:"",onClick:l=>J(p)},{default:o(()=>[v(n(e.$t("transfer.addOrder.form.customCodeHelp")),1)]),_:2},1032,["onClick"]),r(E,{content:e.$t("customers.codeHelp"),placement:"top",class:"custom-code-help"},{default:o(()=>[r($,null,{default:o(()=>[r(C(z))]),_:1})]),_:1},8,["content"])]),_:2},1032,["label"]),r(H,{label:e.$t("transfer.addOrder.form.recentAddress")},{default:o(()=>[a("div",Ae,[a("span",Ne,n(u.recentAddress||e.$t("transfer.addOrder.form.noAddress")),1),u.userNo?(f(),N(c,{key:0,type:"primary",link:"",class:"add-address-btn",onClick:l=>K(p)},{default:o(()=>[v(n(u.userAddressId?e.$t("transfer.addOrder.form.editAddress"):e.$t("transfer.addOrder.form.addAddress"))+" ",1),r(E,{content:e.$t("customers.addressHelp"),placement:"top"},{default:o(()=>[r($,{class:"address-help"},{default:o(()=>[r(C(z))]),_:1})]),_:1},8,["content"])]),_:2},1032,["onClick"])):S("",!0)])]),_:2},1032,["label"])]),_:2},1032,["model"])])]),a("div",Oe,[a("div",Ve,n(e.$t("transfer.addOrder.form.expressTitle")),1),a("div",we,[(f(!0),g(I,null,U(u.trackingInfoList,(l,F)=>(f(),g("div",{key:F,class:"express-item"},[r(B,{modelValue:l.trackingNumber,"onUpdate:modelValue":A=>l.trackingNumber=A,placeholder:e.$t("transfer.addOrder.form.trackingNumber")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),r(B,{modelValue:l.price,"onUpdate:modelValue":A=>l.price=A,placeholder:e.$t("transfer.addOrder.form.value")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),u.trackingInfoList.length>1?(f(),N(c,{key:0,type:"danger",link:"",onClick:A=>X(p,F)},{default:o(()=>[v(n(e.$t("transfer.addOrder.deleteOp")),1)]),_:2},1032,["onClick"])):S("",!0)]))),128)),a("div",Le,[r(c,{type:"primary",plain:"",class:"add-btn",onClick:l=>W(p)},{default:o(()=>[r($,null,{default:o(()=>[r(C(M))]),_:1}),v(" "+n(e.$t("transfer.addOrder.form.addExpress")),1)]),_:2},1032,["onClick"])])])])])]))),128)),a("div",Ie,[r(c,{type:"primary",plain:"",class:"add-order-btn",onClick:Z},{default:o(()=>[r($,null,{default:o(()=>[r(C(M))]),_:1}),v(" "+n(e.$t("transfer.addOrder.title2")),1)]),_:1})]),a("div",Ue,[r(c,{type:"primary",loading:O.value,onClick:Y},{default:o(()=>[v(n(e.$t("transfer.addOrder.form.submit")),1)]),_:1},8,["loading"])])]),r(de,{modelValue:b.value,"onUpdate:modelValue":s[1]||(s[1]=u=>b.value=u),subCode:t.value[k.value].userNo,formData:t.value[k.value],onSubmit:P},null,8,["modelValue","subCode","formData"])])}}},Me=re(Se,[["__scopeId","data-v-e832cc7f"]]);export{Me as default};
