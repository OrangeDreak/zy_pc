import{_ as se,r as h,m as te,g as re,n as oe,c as g,o as f,d as o,a as t,t as d,w as a,e as p,F as A,f as I,q as v,h as k,v as ae,i as N,x as U,s as le,y as ne,p as S,E as _}from"./index-CeCSaknX.js";import{A as de,t as T}from"./AddressForm-CrDAA8jH.js";import{u as ue}from"./currency-DoSCd0KH.js";import{C as ie}from"./CommonHeader-zYzRu31-.js";import{C as ce}from"./CommonFooter-D8Hxzz-O.js";import"./request-Db42XEdn.js";import"./index-C6gr9_Vt.js";import"./common-BTsuERNO.js";const fe={class:"add-transfer"},me={class:"content"},pe={class:"page-header"},ve={class:"title"},_e={class:"section warehouse-section"},he={class:"section-title"},ge={class:"section-tip"},ke={class:"section-tip-icon"},$e={class:"order-header"},Ce={class:"order-title"},be={class:"order-content"},ye={class:"info-section"},Ae={class:"section-title"},Ne={class:"section-content"},Oe={class:"recent-address"},Ve={class:"address-text"},we={class:"info-section"},Le={class:"section-title"},Ie={class:"section-content"},Ue={class:"add-express"},Se={class:"add-order-section"},Te={class:"submit-section"},De={__name:"AddTransferOrder",setup(Ee){const z=re(),M=ue(),j=h(""),O=h(!1),C=h(!1),$=h(0),V=h(!1),b=h([]),q=async(e,s)=>{if(r.value[e].userNo=s,s){V.value=!0;try{const i=await T.subUserList({userNo:s,pageSize:100,pageNo:1});b.value=i.data.map(n=>({...n,value:n.userNo,label:n.userNo}))}catch(i){console.error("搜索失败:",i),_.error("搜索失败")}finally{V.value=!1}}else b.value=[]},Q=e=>{console.log(111222,r.value[e].userNo),b.value.map(s=>{s.value===r.value[e].userNo&&(r.value[e].recentAddress=`${s.userAddressInfo.firstName}, ${s.userAddressInfo.address}, ${s.userAddressInfo.mobile}`,r.value[e].userAddressInfo=s.userAddressInfo,r.value[e].userAddressId=s.userAddressInfo.id)})},w=()=>({userNo:"",recentAddress:"",userAddressId:"",userAddressInfo:{},trackingInfoList:[{trackingNumber:"",price:"",images:[]}]}),r=h([w()]),D=()=>{const e=new Date;j.value=e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")};let L=null;te(()=>{D(),L=setInterval(D,1e3),M.token||z.push("/login")}),oe(()=>{L&&clearInterval(L)});const R=async e=>{try{const s=await T.getCustomCode();r.value[e].userNo=s.data,r.value[e].recentAddress="",r.value[e].userAddressInfo={},r.value[e].userAddressId=""}catch{_.error("获取自定义编码失败")}},G=e=>{$.value=e,C.value=!0},J=e=>{r.value[$.value].recentAddress=`${e.name}, ${e.address}, ${e.mobile}`,r.value[$.value].userAddressInfo=e,C.value=!1},K=e=>{r.value[e].trackingInfoList.push({trackingNumber:"",price:"",images:[]})},P=(e,s)=>{r.value[e].trackingInfoList.length>1&&r.value[e].trackingInfoList.splice(s,1)},W=async()=>{if((()=>{for(let s=0;s<r.value.length;s++){const i=r.value[s];if(!i.userNo)return _.error(`第 ${s+1} 个订单的用户编码不能为空`),!1;if(i.trackingInfoList.length===0)return _.error(`第 ${s+1} 个订单的快递单号列表不能为空`),!1;for(let n=0;n<i.trackingInfoList.length;n++){const c=i.trackingInfoList[n];if(!c.trackingNumber)return _.error(`第 ${s+1} 个订单的第 ${n+1} 个快递单号不能为空`),!1;if(!c.price)return _.error(`第 ${s+1} 个订单的第 ${n+1} 个快递单号的价格不能为空`),!1}}return!0})()){O.value=!0;try{console.log("提交的订单数据:",r.value);const s={};s.transportDataList=r.value,await T.submitTpOrder(s),_.success("提交成功"),r.value=[w()]}catch(s){console.error("提交失败:",s),_.error("提交失败")}finally{O.value=!1}}},X=()=>{r.value.push(w())},Y=e=>{r.value.length>1&&r.value.splice(e,1)};return(e,s)=>{const i=p("el-link"),n=p("el-icon"),c=p("el-button"),Z=p("el-option"),x=p("el-select"),E=p("el-tooltip"),F=p("el-form-item"),ee=p("el-form"),H=p("el-input");return f(),g(A,null,[o("div",fe,[t(ie),o("div",me,[o("div",pe,[o("div",ve,d(e.$t("transfer.addOrder.title")),1),t(i,{type:"primary",onClick:s[0]||(s[0]=u=>e.$router.push("/orders"))},{default:a(()=>[v(d(e.$t("transfer.addOrder.backToList")),1)]),_:1})]),o("div",_e,[o("div",he,d(e.$t("transfer.addOrder.warehouse.title")),1),o("div",ge,[o("div",ke,[t(n,null,{default:a(()=>[t(k(ae))]),_:1})]),s[2]||(s[2]=o("div",null,[o("p",null,"联系人：QCelf"),o("p",null,"电话：17840804025"),o("p",null,"地址：广东省东莞市塘厦镇向阳路331号(佳邮国际进门左手边1楼)")],-1))])]),(f(!0),g(A,null,I(r.value,(u,m)=>(f(),g("div",{key:m,class:"order-group"},[o("div",$e,[o("div",Ce,d(e.$t("transfer.addOrder.order"))+" #"+d(m+1),1),r.value.length>1?(f(),N(c,{key:0,type:"danger",link:"",onClick:l=>Y(m)},{default:a(()=>[v(d(e.$t("transfer.addOrder.deleteOrder")),1)]),_:2},1032,["onClick"])):U("",!0)]),o("div",be,[o("div",ye,[o("div",Ae,d(e.$t("transfer.addOrder.form.title")),1),o("div",Ne,[t(ee,{model:u,"label-width":"120px"},{default:a(()=>[t(F,{label:e.$t("transfer.addOrder.form.customCode"),required:""},{default:a(()=>[t(x,{modelValue:u.userNo,"onUpdate:modelValue":l=>u.userNo=l,filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入关键词搜索","remote-method":l=>q(m,l),loading:V.value,onChange:l=>Q(m),class:"custom-code-select"},{prefix:a(()=>[t(n,null,{default:a(()=>[t(k(le))]),_:1})]),default:a(()=>[(f(!0),g(A,null,I(b.value,l=>(f(),N(Z,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","remote-method","loading","onChange"]),t(c,{type:"primary",plain:"",onClick:l=>R(m)},{default:a(()=>[v(d(e.$t("transfer.addOrder.form.customCodeHelp")),1)]),_:2},1032,["onClick"]),t(E,{content:e.$t("customers.codeHelp"),placement:"top",class:"custom-code-help"},{default:a(()=>[t(n,null,{default:a(()=>[t(k(ne))]),_:1})]),_:1},8,["content"])]),_:2},1032,["label"]),t(F,{label:e.$t("transfer.addOrder.form.recentAddress")},{default:a(()=>[o("div",Oe,[o("span",Ve,d(u.recentAddress||e.$t("transfer.addOrder.form.noAddress")),1),u.userNo?(f(),N(c,{key:0,type:"primary",link:"",class:"add-address-btn",onClick:l=>G(m)},{default:a(()=>[v(d(u.userAddressId?e.$t("transfer.addOrder.form.editAddress"):e.$t("transfer.addOrder.form.addAddress"))+" ",1),t(E,{content:e.$t("customers.addressHelp"),placement:"top"},{default:a(()=>[t(n,{class:"address-help"},{default:a(()=>[t(k(S))]),_:1})]),_:1},8,["content"])]),_:2},1032,["onClick"])):U("",!0)])]),_:2},1032,["label"])]),_:2},1032,["model"])])]),o("div",we,[o("div",Le,d(e.$t("transfer.addOrder.form.expressTitle")),1),o("div",Ie,[(f(!0),g(A,null,I(u.trackingInfoList,(l,B)=>(f(),g("div",{key:B,class:"express-item"},[t(H,{modelValue:l.trackingNumber,"onUpdate:modelValue":y=>l.trackingNumber=y,placeholder:e.$t("transfer.addOrder.form.trackingNumber")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),t(H,{modelValue:l.price,"onUpdate:modelValue":y=>l.price=y,placeholder:e.$t("transfer.addOrder.form.value")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),u.trackingInfoList.length>1?(f(),N(c,{key:0,type:"danger",link:"",onClick:y=>P(m,B)},{default:a(()=>[v(d(e.$t("transfer.addOrder.deleteOp")),1)]),_:2},1032,["onClick"])):U("",!0)]))),128)),o("div",Ue,[t(c,{type:"primary",plain:"",class:"add-btn",onClick:l=>K(m)},{default:a(()=>[t(n,null,{default:a(()=>[t(k(S))]),_:1}),v(" "+d(e.$t("transfer.addOrder.form.addExpress")),1)]),_:2},1032,["onClick"])])])])])]))),128)),o("div",Se,[t(c,{type:"primary",plain:"",class:"add-order-btn",onClick:X},{default:a(()=>[t(n,null,{default:a(()=>[t(k(S))]),_:1}),v(" "+d(e.$t("transfer.addOrder.title2")),1)]),_:1})]),o("div",Te,[t(c,{type:"primary",loading:O.value,onClick:W},{default:a(()=>[v(d(e.$t("transfer.addOrder.form.submit")),1)]),_:1},8,["loading"])])]),t(de,{modelValue:C.value,"onUpdate:modelValue":s[1]||(s[1]=u=>C.value=u),subCode:r.value[$.value].userNo,formData:r.value[$.value],onSubmit:J},null,8,["modelValue","subCode","formData"])]),t(ce)],64)}}},Re=se(De,[["__scopeId","data-v-c5bd672d"]]);export{Re as default};
