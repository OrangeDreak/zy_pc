import{_ as ae,r as g,v as oe,u as le,x as ne,d as k,o as c,e as t,f as o,q as n,w as a,i as f,F as L,j as U,g as m,n as N,z as S,k as C,A as de,B as H,C as j,E as v}from"./index-1wkJ92Wy.js";import{A as ue,t as T}from"./AddressForm-CVg9fji2.js";import{u as ie}from"./currency-CN74YD4t.js";import{C as ce}from"./CommonHeader-8gnz00bh.js";import"./request-DAa1bAHQ.js";const fe={class:"add-transfer"},me={class:"content"},pe={class:"page-header"},ve={class:"title"},_e={class:"section warehouse-section"},he={class:"section-title"},ge={class:"section-content"},ke={class:"section-tip"},$e={class:"order-header"},Ce={class:"order-title"},be={class:"order-content"},ye={class:"info-section"},Ae={class:"section-title"},Ne={class:"section-content"},Oe={class:"recent-address"},we={class:"address-text"},Ve={class:"info-section"},Ie={class:"section-title"},Le={class:"section-content"},Ue={class:"add-express"},Se={class:"add-order-section"},Te={class:"submit-section"},De={__name:"AddTransferOrder",setup(Ee){const q=le(),M=ie(),R=g(""),O=g(!1),b=g(!1),p=g(0),w=g(!1),y=g([]),W=async e=>{if(e){w.value=!0;try{const s=await T.subUserList({userNo:e,pageSize:100,pageNo:1});y.value=s.data.map(d=>({...d,value:d.userNo,label:d.userNo}))}catch(s){console.error("搜索失败:",s),v.error("搜索失败")}finally{w.value=!1}}else y.value=[]},G=e=>{console.log(r.value[e].userNo),y.value.map(s=>{s.value===r.value[e].userNo&&(r.value[e].recentAddress=`${s.userAddressInfo.firstName}, ${s.userAddressInfo.address}, ${s.userAddressInfo.mobile}`,r.value[e].userAddressInfo=s.userAddressInfo,r.value[e].userAddressId=s.userAddressInfo.id)})},V=()=>({userNo:"",recentAddress:"",userAddressId:"",userAddressInfo:{},trackingInfoList:[{trackingNumber:"",price:"",images:[]}]}),r=g([V()]),D=()=>{const e=new Date;R.value=e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")};let I=null;oe(()=>{D(),I=setInterval(D,1e3),M.token||q.push("/login")}),ne(()=>{I&&clearInterval(I)});const J=()=>{v.info("请联系在线客服获取仓库地址")},K=async()=>{try{const e=await T.getCustomCode();r.value[p.value].userNo=e.data,r.value[p.value].recentAddress="",r.value[p.value].userAddressInfo={},r.value[p.value].userAddressId=""}catch{v.error("获取自定义编码失败")}},P=e=>{p.value=e,b.value=!0},Q=e=>{r.value[p.value].recentAddress=`${e.name}, ${e.address}, ${e.mobile}`,r.value[p.value].userAddressInfo=e,b.value=!1},X=e=>{r.value[e].trackingInfoList.push({trackingNumber:"",price:"",images:[]})},Y=(e,s)=>{r.value[e].trackingInfoList.length>1&&r.value[e].trackingInfoList.splice(s,1)},Z=async()=>{if((()=>{for(let s=0;s<r.value.length;s++){const d=r.value[s];if(!d.userNo)return v.error(`第 ${s+1} 个订单的用户编码不能为空`),!1;if(d.trackingInfoList.length===0)return v.error(`第 ${s+1} 个订单的快递单号列表不能为空`),!1;for(let _=0;_<d.trackingInfoList.length;_++){const i=d.trackingInfoList[_];if(!i.trackingNumber)return v.error(`第 ${s+1} 个订单的第 ${_+1} 个快递单号不能为空`),!1;if(!i.price)return v.error(`第 ${s+1} 个订单的第 ${_+1} 个快递单号的价格不能为空`),!1}}return!0})()){O.value=!0;try{console.log("提交的订单数据:",r.value);const s={};s.transportDataList=r.value,await T.submitTpOrder(s),v.success("提交成功"),r.value=[V()]}catch(s){console.error("提交失败:",s),v.error("提交失败")}finally{O.value=!1}}},x=()=>{r.value.push(V())},ee=e=>{r.value.length>1&&r.value.splice(e,1)};return(e,s)=>{const d=f("el-link"),_=f("el-alert"),i=f("el-button"),se=f("el-option"),$=f("el-icon"),te=f("el-select"),E=f("el-tooltip"),B=f("el-form-item"),re=f("el-form"),F=f("el-input");return c(),k("div",fe,[t(ce),o("div",me,[o("div",pe,[o("div",ve,n(e.$t("transfer.addOrder.title")),1),t(d,{type:"primary",onClick:s[0]||(s[0]=u=>e.$router.push("/orders"))},{default:a(()=>[m(n(e.$t("transfer.addOrder.backToList")),1)]),_:1})]),o("div",_e,[o("div",he,n(e.$t("transfer.addOrder.warehouse.title")),1),o("div",ge,[t(d,{type:"primary",onClick:J},{default:a(()=>[m(n(e.$t("transfer.addOrder.warehouse.getAddress")),1)]),_:1})]),o("div",ke,[t(_,{type:"warning",closable:!1,"show-icon":""},{default:a(()=>[m(n(e.$t("transfer.addOrder.warehouse.tip")),1)]),_:1})])]),(c(!0),k(L,null,U(r.value,(u,h)=>(c(),k("div",{key:h,class:"order-group"},[o("div",$e,[o("div",Ce,"转运订单 #"+n(h+1),1),r.value.length>1?(c(),N(i,{key:0,type:"danger",link:"",onClick:l=>ee(h)},{default:a(()=>s[2]||(s[2]=[m(" 删除此订单 ")])),_:2},1032,["onClick"])):S("",!0)]),o("div",be,[o("div",ye,[o("div",Ae,n(e.$t("transfer.addOrder.form.title")),1),o("div",Ne,[t(re,{model:u,"label-width":"120px"},{default:a(()=>[t(B,{label:e.$t("transfer.addOrder.form.customCode"),required:""},{default:a(()=>[t(te,{modelValue:u.userNo,"onUpdate:modelValue":l=>u.userNo=l,filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入关键词搜索","remote-method":W,loading:w.value,onChange:l=>G(h),class:"custom-code-select"},{prefix:a(()=>[t($,null,{default:a(()=>[t(C(de))]),_:1})]),default:a(()=>[(c(!0),k(L,null,U(y.value,l=>(c(),N(se,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","loading","onChange"]),t(i,{type:"primary",plain:"",onClick:K},{default:a(()=>[m(n(e.$t("transfer.addOrder.form.customCodeHelp")),1)]),_:1}),t(E,{content:"编码说明",placement:"top",class:"custom-code-help"},{default:a(()=>[t($,null,{default:a(()=>[t(C(H))]),_:1})]),_:1})]),_:2},1032,["label"]),t(B,{label:e.$t("transfer.addOrder.form.recentAddress")},{default:a(()=>[o("div",Oe,[o("span",we,n(u.recentAddress||e.$t("transfer.addOrder.form.noAddress")),1),u.userNo?(c(),N(i,{key:0,type:"primary",link:"",class:"add-address-btn",onClick:l=>P(h)},{default:a(()=>[m(n(u.userAddressId?e.$t("transfer.addOrder.form.editAddress"):e.$t("transfer.addOrder.form.addAddress"))+" ",1),t(E,{content:"地址说明",placement:"top"},{default:a(()=>[t($,{class:"address-help"},{default:a(()=>[t(C(H))]),_:1})]),_:1})]),_:2},1032,["onClick"])):S("",!0)])]),_:2},1032,["label"])]),_:2},1032,["model"])])]),o("div",Ve,[o("div",Ie,n(e.$t("transfer.addOrder.form.expressTitle")),1),o("div",Le,[(c(!0),k(L,null,U(u.trackingInfoList,(l,z)=>(c(),k("div",{key:z,class:"express-item"},[t(F,{modelValue:l.trackingNumber,"onUpdate:modelValue":A=>l.trackingNumber=A,placeholder:e.$t("transfer.addOrder.form.trackingNumber")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),t(F,{modelValue:l.price,"onUpdate:modelValue":A=>l.price=A,placeholder:e.$t("transfer.addOrder.form.value")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),u.trackingInfoList.length>1?(c(),N(i,{key:0,type:"danger",link:"",onClick:A=>Y(h,z)},{default:a(()=>s[3]||(s[3]=[m(" 删除 ")])),_:2},1032,["onClick"])):S("",!0)]))),128)),o("div",Ue,[t(i,{type:"primary",plain:"",class:"add-btn",onClick:l=>X(h)},{default:a(()=>[t($,null,{default:a(()=>[t(C(j))]),_:1}),m(" "+n(e.$t("transfer.addOrder.form.addExpress")),1)]),_:2},1032,["onClick"])])])])])]))),128)),o("div",Se,[t(i,{type:"primary",plain:"",class:"add-order-btn",onClick:x},{default:a(()=>[t($,null,{default:a(()=>[t(C(j))]),_:1}),s[4]||(s[4]=m(" 添加新的转运订单 "))]),_:1})]),o("div",Te,[t(i,{type:"primary",loading:O.value,onClick:Z},{default:a(()=>[m(n(e.$t("transfer.addOrder.form.submit")),1)]),_:1},8,["loading"])])]),t(ue,{modelValue:b.value,"onUpdate:modelValue":s[1]||(s[1]=u=>b.value=u),subCode:r.value[p.value].userNo,formData:r.value[p.value],onSubmit:Q},null,8,["modelValue","subCode","formData"])])}}},qe=ae(De,[["__scopeId","data-v-8cf9d5fe"]]);export{qe as default};
