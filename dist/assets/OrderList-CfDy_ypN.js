import{a as D}from"./orderList-oxbKkESx.js";import{a5 as J,n as K,x as U,r as f,o as Q,G as X,E as z,u as Y,_ as Z,c,b as u,d as l,m as S,F as M,k as B,e as o,f as k,w as i,t as s,A as q,j as C,l as O}from"./index-CAD5YEHZ.js";import"./request-Ci6vZ18k.js";import"./auth-BVoTKOlD.js";const x=J({name:"OrderList",setup(){const t=Y(),r=X(),{proxy:d}=K(),P=({row:a})=>a.isMark?"status-mark":"",y=U({currentPage:1,pageSize:10}),F=U({userNo:"",trackingNo:"",isMark:0}),$=f([]),p=f(0),g=f(!1),_=f(null),N=f({}),m=f(-1),v=f([]),I=f([{status:-1,icon:"icon-all",label:d.$t("package.status.all"),count:"allOrder"},{status:0,icon:"icon-recorded",label:d.$t("package.status.recorded"),count:"enterCount"},{status:1,icon:"icon-qc",label:d.$t("package.status.qc"),count:"qcCount"},{status:10,icon:"icon-shipped",label:d.$t("package.status.waitPay"),count:"sendCount"},{status:11,icon:"icon-processing",label:d.$t("package.status.processing"),count:"signCount"},{status:12,icon:"icon-delivered",label:d.$t("package.status.delivered"),count:"signCount"},{status:13,icon:"icon-finished",label:d.$t("package.status.finished"),count:"signCount"}]);Q(()=>{r.query.userNo&&(F.userNo=r.query.userNo),n()});const E=async a=>{v.value=a},V=async()=>{t.push("/estimate")},e=async()=>{if(v.value.length===0){z.error(d.$t("order.orderSelectTip"));return}let a=v.value[0].userNo,h=!0;if(v.value.forEach(A=>{A.userNo!==a&&(h=!1)}),!h){z.error(d.$t("order.orderNotSameUserTip"));return}const L=v.value.map(A=>A.id);console.log(L),sessionStorage.setItem("SubOrderIds",L),t.push("/submit-transfer")},n=async()=>{try{g.value=!0,_.value=null;let a={pageNo:y.currentPage,pageSize:y.pageSize,...F};a.isMark||delete a.isMark,m.value>-1&&(a.status=m.value);let h="getOrderList";m.value<10?(a.status=m.value,h="getOrderList"):(a.status=m.value,h="myPackageOrderList");const L=await D[h](a);$.value=L.data,p.value=L.total}catch(a){_.value=a.message||"获取订单失败",z.error("获取订单列表失败")}finally{g.value=!1}},b=()=>{n()},w=()=>{F.isMark=F.isMark?0:1,n()},T=async()=>{try{const a=await D.getOrderCount();N.value=a.data}catch{}},R=a=>{y.pageSize=a,n()},j=a=>{y.currentPage=a,n()},G=async a=>{const{data:h}=await D.updateAttentionMark({tpSubOrderId:a.id,isMark:a.isMark?0:1});z.success(`标记订单：${a.trackingNo}`),n()},W=async a=>{const{data:h}=await D.getSharingCode({userNo:a.userNo,orderId:a.id});console.log(2222,h),z.success(`分享订单：${a.trackingNo}`)},H=a=>{m.value=a,n()};return T(),{searchForm:F,orders:$,total:p,pagination:y,status:m,flowItems:I,selectedOrders:v,countList:N,handleSizeChange:R,handleCurrentChange:j,handleFlowItemClick:H,handleStarClick:W,handleMarkClick:G,handleSelectionChange:E,handleSendSubmit:e,handleEstimate:V,getCountList:T,handleSearch:b,handleSearchMark:w,tableRowClassName:P}}}),ee={class:"order-list"},te={class:"order-flow"},ae=["onClick"],se={class:"search-toolbar"},ne={class:"order-list-content"},le={key:0},oe={key:0},ie={class:"timeline"},re={class:"image-list"},ue={key:1,class:"estimate-info"},ce={key:0},de={class:"timeline"},pe={key:0},ge={key:0,class:"btn-box"},me={class:"pagination"},ke={class:"total"};function he(t,r,d,P,y,F){const $=k("el-input"),p=k("el-button"),g=k("el-table-column"),_=k("el-timeline-item"),N=k("el-timeline"),m=k("el-popover"),v=k("el-image"),I=k("el-tag"),E=k("el-table"),V=k("el-pagination");return u(),c("div",ee,[l("div",te,[(u(!0),c(M,null,B(t.flowItems,e=>(u(),c("div",{key:e.status,class:q(["flow-item",{active:e.status===t.status}]),onClick:n=>t.handleFlowItemClick(e.status)},[l("i",{class:q(e.icon)},null,2),l("span",null,s(e.label)+"("+s(t.countList[e.count])+")",1)],10,ae))),128))]),l("div",se,[o($,{modelValue:t.searchForm.trackingNo,"onUpdate:modelValue":r[0]||(r[0]=e=>t.searchForm.trackingNo=e),placeholder:t.$t("order.toolbar.trackingSearch"),class:"search-input"},null,8,["modelValue","placeholder"]),o($,{modelValue:t.searchForm.userNo,"onUpdate:modelValue":r[1]||(r[1]=e=>t.searchForm.userNo=e),placeholder:t.$t("order.toolbar.customerSearch"),class:"search-input"},null,8,["modelValue","placeholder"]),o(p,{onClick:t.handleSearch},{default:i(()=>[C(s(t.$t("header.searchButton")),1)]),_:1},8,["onClick"]),o(p,{type:t.searchForm.isMark?"primary":"default",onClick:t.handleSearchMark},{default:i(()=>[C(s(t.$t("order.toolbar.starred")),1)]),_:1},8,["type","onClick"])]),l("div",ne,[o(E,{data:t.orders,onSelectionChange:t.handleSelectionChange,style:{width:"100%"},"row-class-name":t.tableRowClassName,stripe:""},{default:i(()=>[t.status===1?(u(),O(g,{key:0,type:"selection",width:"55"})):S("",!0),o(g,{prop:"userNo",label:t.$t("package.table.customerCode"),width:"100"},null,8,["label"]),o(g,{prop:"userNo",label:t.$t("package.table.addressInfo"),width:"320"},{default:i(({row:e})=>r[4]||(r[4]=[l("div",{class:"user-info"},null,-1)])),_:1},8,["label"]),o(g,{prop:"logisticsNumber",label:t.$t("package.table.expressDelivery")},{default:i(({row:e})=>[e.status>10?(u(),c("div",le,[l("div",null,s(t.$t("trackingNumber"))+"："+s(e.logisticsNumber),1),o(m,{width:800},{reference:i(()=>{var n;return[e.trackingList&&e.trackingList.length>0?(u(),c("div",oe,s(t.$t("logisticsTrack"))+"："+s(e.trackingList&&((n=e.trackingList[0])==null?void 0:n.logisticsDesc)),1)):S("",!0)]}),default:i(()=>[l("div",ie,[o(N,null,{default:i(()=>[(u(!0),c(M,null,B(e.trackingList,(n,b)=>(u(),O(_,{key:b,timestamp:n.gmtTime,placement:"top"},{default:i(()=>[l("p",null,s(n.logisticsDesc),1)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)])]),_:2},1024),l("div",re,[(u(!0),c(M,null,B(e.imgUrlList,(n,b)=>(u(),c("div",{key:n,class:"block"},[o(v,{class:"image-list-item",style:{width:"60px",height:"60px"},"close-on-press-escape":"","preview-teleported":"",src:n,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":e.imgUrlList,"initial-index":b,"z-index":"8",fit:"cover"},null,8,["src","preview-src-list","initial-index"])]))),128))])])):(u(),c("div",ue,[l("div",null,[l("div",null,"国际单号："+s(e.orderNo),1),l("div",null,"物流线路："+s(e.logisticsLine),1),o(m,{width:800},{reference:i(()=>{var n;return[e.trackingList&&e.trackingList.length>0?(u(),c("div",ce,s(t.$t("logisticsTrack"))+"："+s(e.trackingList&&((n=e.trackingList[0])==null?void 0:n.logisticsDesc)),1)):S("",!0)]}),default:i(()=>[l("div",de,[o(N,null,{default:i(()=>[(u(!0),c(M,null,B(e.trackingList,(n,b)=>(u(),O(_,{key:b,timestamp:n.gmtTime,placement:"top"},{default:i(()=>[l("p",null,s(n.logisticsDesc),1)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)])]),_:2},1024),l("div",null,"包裹运费："+s(e.estimateFreightPrice),1)]),l("div",null,[l("div",null,"长 "+s(e.length)+"，宽"+s(e.width)+"，高"+s(e.height),1),l("div",null,s(e.realWeight)+"kg；内含8件",1),r[5]||(r[5]=l("div",null,"在途 7 天",-1))])]))]),_:1},8,["label"]),o(g,{prop:"gmtCreate",label:t.$t("commont.createTime"),width:"100"},null,8,["label"]),o(g,{prop:"statusDesc",label:t.$t("package.table.latestStatus"),width:"100"},{default:i(({row:e})=>[o(I,null,{default:i(()=>[C(s(e.statusDesc),1)]),_:2},1024)]),_:1},8,["label"]),o(g,{label:t.$t("commont.operation"),width:"200",align:"center"},{default:i(({row:e})=>[l("div",null,[o(p,{type:"text",icon:e.isStarred?"el-icon-star-on":"el-icon-star-off",class:"star-btn",onClick:n=>t.handleStarClick(e)},{default:i(()=>[C(s(t.$t("commont.share")),1)]),_:2},1032,["icon","onClick"]),o(p,{type:"text",icon:e.isStarred?"el-icon-star-on":"el-icon-star-off",class:"star-btn",onClick:n=>t.handleMarkClick(e)},{default:i(()=>[C(s(e.isMark?t.$t("package.cancelSpecialFocus"):t.$t("package.specialFocus")),1)]),_:2},1032,["icon","onClick"])]),e.status>=10?(u(),c("div",pe,[o(p,{type:"text",icon:e.isStarred?"el-icon-star-on":"el-icon-star-off",class:"star-btn"},{default:i(()=>r[6]||(r[6]=[C(" 包裹详情 ")])),_:2},1032,["icon"]),e.status==10?(u(),O(p,{key:0,type:"text",class:"star-btn"},{default:i(()=>r[7]||(r[7]=[C(" 去支付 ")])),_:1})):S("",!0)])):S("",!0)]),_:1},8,["label"])]),_:1},8,["data","onSelectionChange","row-class-name"])]),t.status===1?(u(),c("div",ge,[o(p,{type:"primary",onClick:t.handleSendSubmit},{default:i(()=>[C(s(t.$t("package.oneClickDelivery")),1)]),_:1},8,["onClick"])])):S("",!0),l("div",me,[l("div",ke,s(t.$t("commont.total"))+" "+s(t.total)+" "+s(t.$t("commont.page")),1),o(V,{"current-page":t.pagination.currentPage,"onUpdate:currentPage":r[2]||(r[2]=e=>t.pagination.currentPage=e),"page-size":t.pagination.pageSize,"onUpdate:pageSize":r[3]||(r[3]=e=>t.pagination.pageSize=e),"page-sizes":[10,20,50],total:t.total,layout:"prev, pager, next, sizes",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])}const ye=Z(x,[["render",he],["__scopeId","data-v-e992d62a"]]);export{ye as default};
